import{j as e}from"./ui-DskC_GZ4.js";import{r}from"./vendor-BlHcAAdO.js";import{c as ge,K as me,k as he,T as w,B as c,ag as ue,ah as xe,ai as pe,ak as L,ap as je,P as R,a3 as $,a5 as Y,R as F,a2 as fe,C as ve,Y as _}from"./index-fU-TRYU7.js";import{C as J,a as W}from"./card-BKNPTKQ9.js";import{T as we,a as ye,b as O,c as x,d as Ce,e as h}from"./table-dY4MnRiV.js";import{D as Ne,b as be,c as De,d as Te,e as ke,f as _e}from"./dialog-D6ZzA_3-.js";import{A as Se,a as Me,b as Ae,c as Pe,d as Ee,e as Le,f as Re,g as $e}from"./alert-dialog-Dv_zQmEg.js";import{P as Fe,a as Oe,b as y,c as Ie,e as X,d as Ue,f as ze}from"./pagination-lN0m_bYc.js";import{P as I}from"./plus-BQJ1DQBE.js";import{E as qe}from"./ellipsis-vertical-ZZDI0_RD.js";import{Q as Be,C as He}from"./qr-code-C3h8dGEs.js";import{T as Qe}from"./trash-2-C636hku7.js";import{f as U}from"./format-cwXK75ha.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=ge("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),Ve=(p=6)=>{const C="abcdefghijklmnopqrstuvwxyz0123456789";let N="";for(let j=0;j<p;j++)N+=C.charAt(Math.floor(Math.random()*C.length));return N},cs=()=>{const[p,C]=r.useState([]),[N,j]=r.useState(!0),[Z,f]=r.useState(!1),[ee,S]=r.useState(!1),[v,se]=r.useState(null),[b,z]=r.useState(1),[q,B]=r.useState("standard"),[M,H]=r.useState("unassigned"),[Q,G]=r.useState(""),[D,T]=r.useState(!1),[o,u]=r.useState(1),[ae,te]=r.useState(0),[m,A]=r.useState(""),[ne,V]=r.useState(null),{toast:d}=me(),{t:s}=he(),P=10;r.useEffect(()=>{k()},[o,m]);const k=async()=>{j(!0);try{const{count:a,error:i}=await w.from("nfc_tags").select("*",{count:"exact",head:!0}).ilike("tag_code",`%${m}%`);if(i)throw i;te(a||0);let t=w.from("nfc_tags").select("*, pet:pets(*), owner:users(id, first_name, last_name, email)").ilike("tag_code",`%${m}%`).order("created_at",{ascending:!1}).range((o-1)*P,o*P-1);const{data:g,error:n}=await t;if(n)throw n;C(g||[])}catch(a){d({title:s("error"),description:a.message||s("Failed to fetch tags"),variant:"destructive"})}finally{j(!1)}},re=async()=>{if(b<=0||b>100){d({title:s("error"),description:s("Please enter a number between 1 and 100"),variant:"destructive"});return}T(!0);try{const{data:a,error:i}=await w.auth.getUser();if(i)throw i;if(!a||!a.user)throw new Error("User authentication required");let t=0;const g=new Date().toISOString();for(let n=0;n<b;n++){const E=Ve(),{error:K}=await w.from("nfc_tags").insert({tag_code:E,user_id:null,is_active:M==="active",status:M,tag_type:q,notes:Q||null,created_at:g,last_updated:g});if(K){console.error("Error creating tag:",K);continue}t++}if(t>0)d({title:s("success"),description:`Successfully generated ${t} unowned tag${t>1?"s":""} ready for claiming`}),f(!1),z(1),B("standard"),H("unassigned"),G(""),k();else throw new Error("Failed to create any tags")}catch(a){d({title:s("error"),description:a.message||s("admin.tags.error.generate"),variant:"destructive"})}finally{T(!1)}},ie=async()=>{if(v){T(!0);try{const{error:a}=await w.from("nfc_tags").delete().eq("id",v.id);if(a)throw a;d({title:s("success"),description:s("admin.tags.success.deleted")}),S(!1),k()}catch(a){d({title:s("error"),description:a.message||s("admin.tags.error.delete"),variant:"destructive"})}finally{T(!1)}}},le=a=>{const i=`${window.location.origin}/tag/${a}`;navigator.clipboard.writeText(i),V(a),d({title:s("success"),description:s("admin.tags.success.copied")}),setTimeout(()=>V(null),2e3)},oe=()=>{const a=[["Tag Code","Type","Status","Owner","Pet","Created At","Link"],...p.map(n=>[n.tag_code,n.tag_type||"standard",n.status||(n.is_active?"active":"inactive"),n.owner?`${n.owner.first_name||""} ${n.owner.last_name||""}`.trim():"Unassigned",n.pet?n.pet.name:"None",U(new Date(n.created_at),"yyyy-MM-dd"),`${window.location.origin}/tag/${n.tag_code}`])].map(n=>n.map(E=>`"${E}"`).join(",")).join(`
`),i=new Blob([a],{type:"text/csv"}),t=URL.createObjectURL(i),g=document.createElement("a");g.setAttribute("href",t),g.setAttribute("download",`nfc-tags-${U(new Date,"yyyy-MM-dd")}.csv`),g.click(),URL.revokeObjectURL(t)},ce=()=>{d({title:s("info"),description:s("admin.tags.info.qrExport")})},l=Math.ceil(ae/P),de=a=>U(new Date(a),"MMM d, yyyy");return e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s("admin.tags.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.tags.description")})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(c,{onClick:()=>f(!0),children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," ",s("admin.tags.generate")]}),e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(c,{variant:"outline",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"})," ",s("admin.tags.actions")]})}),e.jsxs(pe,{align:"end",children:[e.jsxs(L,{onClick:oe,children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," ",s("admin.tags.exportCSV")]}),e.jsxs(L,{onClick:ce,children:[e.jsx(Be,{className:"mr-2 h-4 w-4"})," ",s("admin.tags.exportQR")]}),e.jsxs(L,{onClick:k,children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"})," ",s("admin.tags.refresh")]})]})]})]})]}),e.jsx(J,{className:"mb-6",children:e.jsx(W,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(R,{placeholder:s("admin.tags.search"),value:m,onChange:a=>{A(a.target.value),u(1)}})}),e.jsx(c,{variant:"outline",onClick:()=>{A(""),u(1)},disabled:!m,children:s("admin.tags.clear")})]})})}),N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx($,{size:"lg",text:s("admin.tags.loading")})}):e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsx(W,{className:"p-0",children:e.jsxs(we,{children:[e.jsx(ye,{children:e.jsxs(O,{children:[e.jsx(x,{children:s("admin.tags.tagCode")}),e.jsx(x,{children:s("admin.tags.status")}),e.jsx(x,{children:s("admin.tags.owner")}),e.jsx(x,{children:s("admin.tags.pet")}),e.jsx(x,{children:s("admin.tags.created")}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(Ce,{children:p.length===0?e.jsx(O,{children:e.jsx(h,{colSpan:6,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(Y,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:s("admin.tags.noTags")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s(m?"admin.tags.noTagsMatch":"admin.tags.noTagsDescription")}),m?e.jsx(c,{variant:"outline",onClick:()=>A(""),children:s("admin.tags.clearSearch")}):e.jsxs(c,{onClick:()=>f(!0),children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," ",s("admin.tags.generate")]})]})})}):p.map(a=>e.jsxs(O,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-mono",children:a.tag_code})]})}),e.jsx(h,{children:a.status==="unassigned"?e.jsx(F,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:s("admin.tags.unassigned")}):a.is_active?e.jsx(F,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:a.status}):e.jsx(F,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:s("admin.tags.inactive")})}),e.jsx(h,{children:a.owner?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[a.owner.first_name||""," ",a.owner.last_name||""]})]}):e.jsx("span",{className:"text-muted-foreground",children:s("admin.tags.unassigned")})}),e.jsx(h,{children:a.pet?e.jsx("span",{children:a.pet.name}):e.jsx("span",{className:"text-muted-foreground",children:s("admin.tags.none")})}),e.jsx(h,{children:de(a.created_at)}),e.jsxs(h,{className:"text-right",children:[e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>le(a.tag_code),title:"Copy tag link",children:ne===a.tag_code?e.jsx(ve,{className:"h-4 w-4 text-green-500"}):e.jsx(He,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{se(a),S(!0)},title:"Delete tag",children:e.jsx(Qe,{className:"h-4 w-4"})})]}),"                        "]})]},a.id))})]})})}),l>1&&e.jsx(Fe,{className:"mt-4",children:e.jsxs(Oe,{children:[e.jsx(y,{children:e.jsx(Ie,{onClick:()=>u(a=>Math.max(1,a-1)),className:o===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,l)}).map((a,i)=>{let t;return l<=5||o<=3?t=i+1:o>=l-2?t=l-4+i:t=o-2+i,t>l?null:e.jsx(y,{children:e.jsx(X,{onClick:()=>u(t),isActive:o===t,children:t})},t)}),l>5&&o<l-2&&e.jsxs(e.Fragment,{children:[e.jsx(y,{children:e.jsx(Ue,{})}),e.jsx(y,{children:e.jsx(X,{onClick:()=>u(l),children:l})})]}),e.jsx(y,{children:e.jsx(ze,{onClick:()=>u(a=>Math.min(l,a+1)),className:o===l?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]}),e.jsx(Ne,{open:Z,onOpenChange:f,children:e.jsxs(be,{children:[e.jsxs(De,{children:[e.jsx(Te,{children:s("admin.tags.generateDialog.title")}),e.jsx(ke,{children:s("admin.tags.generateDialog.description")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"tagCount",children:s("admin.tags.generateDialog.count")}),e.jsx(R,{id:"tagCount",type:"number",min:"1",max:"100",value:b,onChange:a=>z(parseInt(a.target.value)||1)})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"tagType",children:s("admin.tags.generateDialog.type")}),e.jsxs("select",{id:"tagType",value:q,onChange:a=>B(a.target.value),className:"w-full border rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"standard",children:s("admin.tags.types.standard")}),e.jsx("option",{value:"premium",children:s("admin.tags.types.premium")})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"tagStatus",children:s("admin.tags.generateDialog.status")}),e.jsxs("select",{id:"tagStatus",value:M,onChange:a=>H(a.target.value),className:"w-full border rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"unassigned",children:s("admin.tags.status.unassigned")}),e.jsx("option",{value:"active",children:s("admin.tags.status.active")}),e.jsx("option",{value:"inactive",children:s("admin.tags.status.inactive")})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"tagNotes",children:s("admin.tags.generateDialog.notes")}),e.jsx(R,{id:"tagNotes",value:Q,onChange:a=>G(a.target.value),placeholder:s("admin.tags.generateDialog.notesPlaceholder")})]})]}),e.jsxs(_e,{children:[e.jsx(c,{variant:"outline",onClick:()=>f(!1),children:s("admin.tags.generateDialog.cancel")}),e.jsxs(c,{onClick:re,disabled:D,children:[D?e.jsx($,{size:"sm",className:"mr-2"}):e.jsx(I,{className:"mr-2 h-4 w-4"}),s("admin.tags.generateDialog.generate")]})]})]})}),e.jsx(Se,{open:ee,onOpenChange:S,children:e.jsxs(Me,{children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:s("admin.tags.deleteDialog.title")}),e.jsxs(Ee,{children:[s("admin.tags.deleteDialog.description"),(v==null?void 0:v.pet_id)&&e.jsxs("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded-md",children:[e.jsxs("span",{className:"font-semibold text-amber-700",children:[s("warning"),":"]})," ",s("admin.tags.deleteDialog.warning")]})]})]}),e.jsxs(Le,{children:[e.jsx(Re,{children:s("admin.tags.deleteDialog.cancel")}),e.jsxs($e,{onClick:ie,disabled:D,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[D?e.jsx($,{size:"sm",className:"mr-2"}):null,s("admin.tags.deleteDialog.delete")]})]})]})})]})};export{cs as default};
