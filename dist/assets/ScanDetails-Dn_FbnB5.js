import{j as e}from"./ui-DskC_GZ4.js";import{r as m}from"./vendor-BlHcAAdO.js";import{C as D,b as k,a as C,c as F}from"./card-BKNPTKQ9.js";import{c as z,W as A,N as G,K as R,B as d,$ as B,a5 as I,a7 as O,a2 as q,T as S}from"./index-fU-TRYU7.js";import{S as i}from"./skeleton-ByzPqMQF.js";import{L as T,M as H,T as K,a as W,P as J}from"./maps-dYtw1lZI.js";import{A as o}from"./arrow-right-Cjx1F2w8.js";import{C as E}from"./calendar-BJg_nOUc.js";import{C as Q}from"./clock-BvbAatTJ.js";import{M as V}from"./map-pin-CaB-Fh_N.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=z("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);delete T.Icon.Default.prototype._getIconUrl;T.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"});const X=({coordinates:t,locationName:r="الموقع",height:c="300px",width:s="100%"})=>(m.useEffect(()=>{window.dispatchEvent(new Event("resize"))},[]),!t||!t.lat||!t.lng?e.jsx("div",{style:{height:c,width:s},className:"bg-gray-100 rounded-md flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"لم يتم تحديد الموقع"})}):e.jsx("div",{style:{height:c,width:s},className:"rounded-md overflow-hidden",children:e.jsxs(H,{center:[t.lat,t.lng],zoom:14,style:{height:"100%",width:"100%"},children:[e.jsx(K,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(W,{position:[t.lat,t.lng],children:e.jsx(J,{children:r})})]})})),me=()=>{const{id:t}=A(),r=G(),{toast:c}=R(),[s,M]=m.useState(null),[L,h]=m.useState(!0),P=l=>new Intl.DateTimeFormat("ar-EG",{year:"numeric",month:"long",day:"numeric"}).format(new Date(l)),U=l=>new Intl.DateTimeFormat("ar-EG",{hour:"2-digit",minute:"2-digit"}).format(new Date(l));return m.useEffect(()=>{(async()=>{var p,j,f,N,v,g,u,w,b,y,_;if(t)try{h(!0);const{data:{session:n}}=await S.auth.getSession();if(!n){c({title:"غير مصرح",description:"يجب تسجيل الدخول لعرض تفاصيل المسح",variant:"destructive"}),r("/login");return}const{data:a,error:$}=await S.from("nfc_scans").select(`
            id,
            tag_id,
            location,
            device_info,
            scanner_ip,
            created_at,
            pet:pet_id (
              id,
              name,
              profile_image_url,
              owner_id
            )
          `).eq("id",t).single();if($||!a)throw new Error("سجل المسح غير موجود");if(((p=a.pet)==null?void 0:p.owner_id)!==n.user.id){c({title:"رفض الوصول",description:"ليس لديك صلاحية لعرض سجل المسح هذا",variant:"destructive"}),r("/dashboard/scan-records");return}M({id:a.id,petName:((j=a.pet)==null?void 0:j.name)||"حيوان أليف غير معروف",petId:(f=a.pet)==null?void 0:f.id,petImage:(N=a.pet)==null?void 0:N.profile_image_url,tagId:a.tag_id,timestamp:a.created_at,location:((v=a.location)==null?void 0:v.address)||"موقع غير معروف",coordinates:((g=a.location)==null?void 0:g.coordinates)||null,scannerInfo:(u=a.device_info)!=null&&u.browser&&((w=a.device_info)!=null&&w.os)?`${a.device_info.browser} / ${a.device_info.os} / ${a.device_info.device||"غير معروف"}`:"جهاز غير معروف",deviceDetails:{browser:(b=a.device_info)==null?void 0:b.browser,os:(y=a.device_info)==null?void 0:y.os,device:(_=a.device_info)==null?void 0:_.device,ip:a.scanner_ip}})}catch(n){console.error("Error fetching scan details:",n),c({title:"خطأ",description:"فشل في تحميل تفاصيل المسح. يرجى المحاولة مرة أخرى لاحقاً.",variant:"destructive"}),r("/dashboard/scan-records")}finally{h(!1)}})()},[t,r,c]),L?e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8 flex items-center",children:[e.jsxs(d,{variant:"ghost",className:"ml-2",onClick:()=>r("/dashboard/scan-records"),children:[e.jsx(o,{className:"h-4 w-4 ml-2"}),"رجوع"]}),e.jsx(i,{className:"h-8 w-48"})]}),e.jsxs(D,{children:[e.jsxs(k,{children:[e.jsx(i,{className:"h-6 w-32 mb-2"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{className:"h-12 w-12 rounded-full ml-4"}),e.jsxs("div",{children:[e.jsx(i,{className:"h-4 w-24 mb-2"}),e.jsx(i,{className:"h-3 w-32"})]})]})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b pb-4",children:[e.jsx(i,{className:"h-4 w-24 mb-2"}),e.jsx(i,{className:"h-3 w-48"})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx(i,{className:"h-4 w-24 mb-2"}),e.jsx(i,{className:"h-3 w-48"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"h-4 w-24 mb-2"}),e.jsx(i,{className:"h-3 w-48"})]})]})})]})]}):s?e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8 flex items-center",children:[e.jsxs(d,{variant:"ghost",className:"ml-2",onClick:()=>r("/dashboard/scan-records"),children:[e.jsx(o,{className:"h-4 w-4 ml-2"}),"رجوع"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"تفاصيل المسح"})]}),e.jsxs(D,{className:"mb-8",children:[e.jsxs(k,{children:[e.jsx(F,{className:"mb-4",children:"معلومات الحيوان الأليف"}),e.jsxs("div",{className:"flex items-center",children:[s.petImage?e.jsx(B,{className:"h-12 w-12 ml-4",children:e.jsx("img",{src:s.petImage,alt:s.petName})}):e.jsx("div",{className:"h-12 w-12 bg-gray-200 rounded-full flex items-center justify-center ml-4",children:e.jsx("span",{className:"text-gray-500",children:"🐾"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.petName}),e.jsx(d,{variant:"link",className:"p-0 h-auto text-sm text-blue-600",onClick:()=>r(`/dashboard/pets/${s.petId}`),children:"عرض ملف الحيوان الأليف"})]})]})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b pb-4",children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center",children:[e.jsx(E,{className:"h-4 w-4 ml-2 text-gray-500"}),"التاريخ والوقت"]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center text-gray-600",children:[e.jsxs("div",{className:"flex items-center ml-6",children:[e.jsx(E,{className:"h-4 w-4 ml-1 text-gray-400"}),e.jsx("span",{children:P(s.timestamp)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"h-4 w-4 ml-1 text-gray-400"}),e.jsx("span",{children:U(s.timestamp)})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center",children:[e.jsx(V,{className:"h-4 w-4 ml-2 text-gray-500"}),"الموقع"]}),e.jsx("p",{className:"text-gray-600 mb-2",children:s.location}),s.coordinates&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{coordinates:s.coordinates,locationName:s.location,height:"300px"}),e.jsxs("p",{className:"text-xs text-gray-500 text-center mt-1",children:["الإحداثيات: ",s.coordinates.lat.toFixed(6),", ",s.coordinates.lng.toFixed(6)]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center",children:[e.jsx(I,{className:"h-4 w-4 ml-2 text-gray-500"}),"معلومات البطاقة"]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(I,{className:"h-4 w-4 ml-1 text-gray-400"}),e.jsx("span",{className:"font-mono",children:s.tagId})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center",children:[e.jsx(x,{className:"h-4 w-4 ml-2 text-gray-500"}),"معلومات الجهاز"]}),s.deviceDetails&&e.jsxs("div",{className:"space-y-2 text-gray-600",children:[s.deviceDetails.browser&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"h-4 w-4 ml-1 text-gray-400"}),e.jsxs("span",{children:["المتصفح: ",s.deviceDetails.browser]})]}),s.deviceDetails.os&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(x,{className:"h-4 w-4 ml-1 text-gray-400"}),e.jsxs("span",{children:["نظام التشغيل: ",s.deviceDetails.os]})]}),s.deviceDetails.device&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(x,{className:"h-4 w-4 ml-1 text-gray-400"}),e.jsxs("span",{children:["الجهاز: ",s.deviceDetails.device]})]}),s.deviceDetails.ip&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"h-4 w-4 ml-1 text-gray-400"}),e.jsxs("span",{children:["IP: ",s.deviceDetails.ip]})]})]})]})]})})]})]}):e.jsxs("div",{className:"container mx-auto py-8 px-4 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"سجل المسح غير موجود"}),e.jsx("p",{className:"mb-4",children:"سجل المسح الذي تبحث عنه غير موجود أو ليس لديك صلاحية لعرضه."}),e.jsxs(d,{onClick:()=>r("/dashboard/scan-records"),children:[e.jsx(o,{className:"h-4 w-4 ml-2"}),"الرجوع إلى سجلات المسح"]})]})};export{me as default};
