import{j as e}from"./ui-DskC_GZ4.js";import{r as l}from"./vendor-BlHcAAdO.js";import{af as G,T as v,B as n,O as J,P as K,R as N}from"./index-fU-TRYU7.js";import{C as Y}from"./card-BKNPTKQ9.js";import{T as Z,a as ee,b as w,c as i,d as se,e as r}from"./table-dY4MnRiV.js";import{S as te,a as ae,b as le,c as re,d as u}from"./select-CjVjgBc2.js";import{D as ie,b as ne,c as ce,d as de,e as oe,f as me}from"./dialog-D6ZzA_3-.js";import{A as R,a as S,b as A,c as T,d as k,e as P,f as L,g as O}from"./alert-dialog-Dv_zQmEg.js";import{R as xe}from"./refresh-cw-_XOA-msa.js";import{I as he}from"./image-DU46GOH3.js";import{M as F}from"./map-pin-CaB-Fh_N.js";import{C as M}from"./calendar-BJg_nOUc.js";import{E as ue}from"./eye-hBmQ-Y1Y.js";import{C as E}from"./circle-check-big-C5mTEYhf.js";import{P as je,M as pe}from"./phone-zyjSBqy0.js";import{C as fe}from"./circle-x-sU9EccIO.js";import{f as ge}from"./format-cwXK75ha.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";const Ie=()=>{const{toast:c}=G(),[I,B]=l.useState([]),[H,y]=l.useState(!0),[j,V]=l.useState(""),[p,U]=l.useState(null),[t,C]=l.useState(null),[q,d]=l.useState(!1),[z,o]=l.useState(!1),[Q,m]=l.useState(!1);l.useEffect(()=>{x()},[]);const x=async()=>{try{y(!0);const{data:s,error:a}=await v.from("lost_found_posts").select(`
          *,
          user:user_id (
            first_name,
            last_name,
            email
          )
        `).order("created_at",{ascending:!1});if(a)throw a;if(s){const g=s.map(h=>({...h,status:h.status}));B(g)}}catch(s){console.error("Error fetching reports:",s),c({title:"Error",description:s.message||"Failed to fetch reports",variant:"destructive"})}finally{y(!1)}},$=s=>{C(s),d(!0)},W=async()=>{if(t)try{const{error:s}=await v.from("lost_found_posts").delete().eq("id",t.id);if(s)throw s;c({title:"Success",description:"Report deleted successfully"}),x(),m(!1),d(!1)}catch(s){c({title:"Error",description:s.message||"Failed to delete report",variant:"destructive"})}},X=async()=>{if(t)try{const{error:s}=await v.from("lost_found_posts").update({status:"resolved",resolved_at:new Date().toISOString()}).eq("id",t.id);if(s)throw s;c({title:"Success",description:"Report marked as resolved"}),x(),o(!1),d(!1)}catch(s){c({title:"Error",description:s.message||"Failed to resolve report",variant:"destructive"})}},f=s=>{if(!s)return"N/A";try{return ge(new Date(s),"MMM dd, yyyy HH:mm")}catch{return"Invalid date"}},_=s=>{switch(s){case"open":return{variant:"default",className:"bg-blue-100 text-blue-800"};case"resolved":return{variant:"default",className:"bg-green-100 text-green-800"};case"closed":return{variant:"secondary",className:"bg-gray-100 text-gray-800"};default:return{variant:"default",className:""}}},D=I.filter(s=>{var b;const a=j.toLowerCase(),g=!j||s.title.toLowerCase().includes(a)||s.description.toLowerCase().includes(a)||s.pet_name&&s.pet_name.toLowerCase().includes(a)||s.last_seen_location&&s.last_seen_location.toLowerCase().includes(a)||((b=s.user)==null?void 0:b.email)&&s.user.email.toLowerCase().includes(a),h=!p||s.status===p;return g&&h});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Lost & Found Reports"}),e.jsxs(n,{onClick:x,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(J,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"Search reports...",className:"pl-10",value:j,onChange:s=>V(s.target.value)})]}),e.jsxs(te,{value:p||"all",onValueChange:s=>U(s==="all"?null:s),children:[e.jsx(ae,{className:"w-[180px]",children:e.jsx(le,{placeholder:"Filter by status"})}),e.jsxs(re,{children:[e.jsx(u,{value:"all",children:"All Status"}),e.jsx(u,{value:"open",children:"Open"}),e.jsx(u,{value:"resolved",children:"Resolved"}),e.jsx(u,{value:"closed",children:"Closed"})]})]})]}),e.jsx(Y,{children:H?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-pet-primary"})}):e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(w,{children:[e.jsx(i,{children:"Title"}),e.jsx(i,{children:"Pet Details"}),e.jsx(i,{children:"Location"}),e.jsx(i,{children:"Reporter"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Date"}),e.jsx(i,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:D.length===0?e.jsx(w,{children:e.jsx(r,{colSpan:7,className:"text-center py-8",children:"No reports found matching your filters"})}):D.map(s=>e.jsxs(w,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 flex items-center justify-center",children:s.image_url?e.jsx("img",{src:s.image_url,alt:"Report",className:"w-full h-full object-cover rounded"}):e.jsx(he,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:s.description})]})]})}),e.jsx(r,{children:e.jsxs("div",{children:[s.pet_name&&e.jsx("p",{className:"font-medium",children:s.pet_name}),s.pet_type&&e.jsx(N,{variant:"outline",className:"mt-1",children:s.pet_type.charAt(0).toUpperCase()+s.pet_type.slice(1)})]})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm truncate max-w-[150px]",children:s.last_seen_location||"Not specified"})]})}),e.jsx(r,{children:s.user?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.user.first_name||s.user.last_name?`${s.user.first_name||""} ${s.user.last_name||""}`.trim():"Anonymous"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.user.email})]}):e.jsx("p",{className:"text-muted-foreground",children:"Anonymous"})}),e.jsx(r,{children:e.jsx(N,{..._(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:f(s.created_at)})]})}),e.jsx(r,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(n,{variant:"ghost",size:"icon",onClick:()=>$(s),children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"View"})]}),s.status==="open"&&e.jsxs(n,{variant:"ghost",size:"icon",onClick:()=>{C(s),o(!0)},children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Mark Resolved"})]})]})})]},s.id))})]})}),e.jsx(ie,{open:q,onOpenChange:d,children:e.jsxs(ne,{className:"max-w-md",children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Report Details"}),e.jsx(oe,{children:"Detailed information about this lost/found report."})]}),t&&e.jsxs("div",{className:"space-y-6",children:[t.image_url&&e.jsx("div",{className:"aspect-video relative rounded-lg overflow-hidden",children:e.jsx("img",{src:t.image_url,alt:"Report",className:"absolute inset-0 w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:t.title}),e.jsx(N,{..._(t.status),className:"mt-2",children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{className:"mt-1",children:t.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pet Name"}),e.jsx("p",{children:t.pet_name||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pet Type"}),e.jsx("p",{children:t.pet_type?t.pet_type.charAt(0).toUpperCase()+t.pet_type.slice(1):"Not specified"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pet Breed"}),e.jsx("p",{children:t.pet_breed||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pet Color"}),e.jsx("p",{children:t.pet_color||"Not specified"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Seen Location"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{children:t.last_seen_location||"Not specified"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Contact Phone"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(je,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{children:t.contact_phone||"Not provided"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Contact Email"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{children:t.contact_email||"Not provided"})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Dates"}),e.jsx("div",{className:"space-y-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm",children:["Reported: ",f(t.created_at)]}),t.resolved_at&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resolved: ",f(t.resolved_at)]})]})]})})]})]}),e.jsxs(me,{className:"mt-6 gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>d(!1),children:"Close"}),t&&t.status==="open"&&e.jsx(e.Fragment,{children:e.jsxs(n,{variant:"default",onClick:()=>{o(!0)},children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Mark as Resolved"]})}),e.jsxs(n,{variant:"destructive",onClick:()=>{m(!0)},children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Delete Report"]})]})]})}),e.jsx(R,{open:z,onOpenChange:o,children:e.jsxs(S,{children:[e.jsxs(A,{children:[e.jsx(T,{children:"Mark as Resolved?"}),e.jsx(k,{children:"This action will mark the report as resolved. This indicates that the pet has been found or returned to their owner."})]}),e.jsxs(P,{children:[e.jsx(L,{onClick:()=>o(!1),children:"Cancel"}),e.jsx(O,{onClick:X,children:"Mark as Resolved"})]})]})}),e.jsx(R,{open:Q,onOpenChange:m,children:e.jsxs(S,{children:[e.jsxs(A,{children:[e.jsx(T,{children:"Delete Report?"}),e.jsx(k,{children:"This action cannot be undone. The report will be permanently deleted from the system."})]}),e.jsxs(P,{children:[e.jsx(L,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(O,{onClick:W,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})})]})};export{Ie as default};
