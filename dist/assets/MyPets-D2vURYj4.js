import{j as e}from"./ui-DskC_GZ4.js";import{r as p}from"./vendor-BlHcAAdO.js";import{C as xe,b as De,c as Se,d as Ve,a as pe,e as Ue}from"./card-BKNPTKQ9.js";import{c as Ke,K as ke,B as b,Y as l,P as x,I as qe,R as H,T as $,k as Te,a3 as Ae,X as Qe,C as ea,O as $e,a2 as aa,a5 as ia}from"./index-fU-TRYU7.js";import{D as ue,a as sa,b as ge,c as ve,d as fe,e as je,f as _e}from"./dialog-D6ZzA_3-.js";import{S as be,a as Ne,b as we,c as Ce,d as G}from"./select-CjVjgBc2.js";import{T as J}from"./textarea-Dl2XRPf0.js";import{u as ta,a as na,s as la,d as ra}from"./upload-helper-OLK1PJwh.js";import{I as ye,S as Ye}from"./square-pen-CbRzSRBQ.js";import{T as Xe,a as Ze,b as Q,c as Ie}from"./tabs-DPPu6Y5N.js";import{S as Be}from"./star-DqQZDmNS.js";import{T as Pe}from"./trash-2-C636hku7.js";import{L as ca}from"./loader-circle-Cj1b-iFM.js";import{P as da}from"./pet-avatar-CuQyVzr2.js";import{S as Fe}from"./skeleton-ByzPqMQF.js";import{A as oa,a as ma,b as ha,c as xa,d as pa,e as ua,f as ga,g as va}from"./alert-dialog-Dv_zQmEg.js";import{P as Re}from"./paw-print-nX1O6nEh.js";import{L as fa}from"./link-Cekgv5dY.js";import{H as ja}from"./heart-C2PLtpQF.js";import{I as _a}from"./info-Dqd7-vNn.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=Ke("Cake",[["path",{d:"M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8",key:"1w3rig"}],["path",{d:"M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1",key:"n2jgmb"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M7 8v3",key:"1qtyvj"}],["path",{d:"M12 8v3",key:"hwp4zt"}],["path",{d:"M17 8v3",key:"1i6e5u"}],["path",{d:"M7 4h.01",key:"1bh4kh"}],["path",{d:"M12 4h.01",key:"1ujb9j"}],["path",{d:"M17 4h.01",key:"1upcoc"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=Ke("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]),He=t=>t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t):!0,We=t=>t?/^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/.test(t):!0,Na=t=>t?t>0&&t<1e3:!0;function Ee({onSuccess:t}){const[C,S]=p.useState(!1),[_,P]=p.useState(!1),{toast:T}=ke(),[M,B]=p.useState(null),[V,r]=p.useState(null),[s,f]=p.useState({}),[i,n]=p.useState({name:"",type:"",breed:"",gender:"",birthday:"",color:"",weight_kg:0,microchip_id:"",notes:"",medical_info:{blood_type:"",conditions:[],allergies:[],medications:[],vaccinations:[],last_checkup:"",next_checkup:"",medical_notes:"",veterinarian:{name:"",phone:"",email:"",clinic:"",address:"",specialization:"",license_number:""}},emergency_contact:{name:"",phone:"",email:"",relationship:"",address:""}}),I=a=>{if(a.target.files&&a.target.files[0]){const c=a.target.files[0];if(c.size>5*1024*1024){T({title:"Error",description:"Image size should be less than 5MB",variant:"destructive"});return}B(c),r(URL.createObjectURL(c))}},v=()=>{const a={};return i.name.trim()||(a.name="Pet name is required"),i.type||(a.type="Pet type is required"),i.medical_info.veterinarian.email&&!He(i.medical_info.veterinarian.email)&&(a.vetEmail="Please enter a valid email address"),i.emergency_contact.email&&!He(i.emergency_contact.email)&&(a.emergencyEmail="Please enter a valid email address"),i.medical_info.veterinarian.phone&&!We(i.medical_info.veterinarian.phone)&&(a.vetPhone="Please enter a valid phone number"),i.emergency_contact.phone&&!We(i.emergency_contact.phone)&&(a.emergencyPhone="Please enter a valid phone number"),i.weight_kg&&!Na(i.weight_kg)&&(a.weight="Please enter a valid weight (0-1000 kg)"),f(a),Object.keys(a).length===0},W=async a=>{if(a.preventDefault(),!v()){T({title:"Validation Error",description:"Please correct the errors in the form",variant:"destructive"});return}P(!0);try{const{data:{user:c}}=await $.auth.getUser();if(!c)throw new Error("User not authenticated");const g={name:i.name.trim(),type:i.type.toLowerCase(),breed:i.breed.trim()||null,gender:i.gender||null,birthday:i.birthday||null,owner_id:c.id,color:i.color||null,weight_kg:i.weight_kg||null,microchip_id:i.microchip_id||null,notes:i.notes||null,medical_info:{...i.medical_info,conditions:i.medical_info.conditions.filter(Boolean),allergies:i.medical_info.allergies.filter(Boolean),medications:i.medical_info.medications.filter(Boolean),vaccinations:i.medical_info.vaccinations.filter(u=>u.name&&u.date)},emergency_contact:{...i.emergency_contact}},{data:y,error:F}=await $.from("pets").insert(g).select().single();if(F)throw F;if(M&&y){const u=await ta(M,y.id),{error:E}=await $.from("pets").update({profile_image_url:u}).eq("id",y.id);if(E)throw E}T({title:"Success",description:"Pet added successfully!"}),S(!1),t&&t(),n({name:"",type:"",breed:"",gender:"",birthday:"",color:"",weight_kg:0,microchip_id:"",notes:"",medical_info:{blood_type:"",conditions:[],allergies:[],medications:[],vaccinations:[],last_checkup:"",next_checkup:"",medical_notes:"",veterinarian:{name:"",phone:"",email:"",clinic:"",address:"",specialization:"",license_number:""}},emergency_contact:{name:"",phone:"",email:"",relationship:"",address:""}}),B(null),r(null)}catch(c){T({title:"Error",description:c.message||"Failed to add pet",variant:"destructive"})}finally{P(!1)}},R=()=>{n(a=>({...a,medical_info:{...a.medical_info,vaccinations:[...a.medical_info.vaccinations,{name:"",date:"",next_due:""}]}}))},z=a=>{n(c=>({...c,medical_info:{...c.medical_info,vaccinations:c.medical_info.vaccinations.filter((g,y)=>y!==a)}}))},w=(a,c)=>{c.trim()&&n(g=>({...g,medical_info:{...g.medical_info,[a]:[...g.medical_info[a],c.trim()]}}))},L=(a,c)=>{n(g=>({...g,medical_info:{...g.medical_info,[a]:g.medical_info[a].filter((y,F)=>F!==c)}}))};return e.jsxs(ue,{open:C,onOpenChange:S,children:[e.jsx(sa,{asChild:!0,children:e.jsx(b,{className:"bg-pet-primary hover:bg-pet-secondary",children:"+ Add New Pet"})}),e.jsxs(ge,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:"Add New Pet"}),e.jsx(je,{children:"Fill in your pet's details below."})]}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Basic Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"pet-image",children:"Pet Image"}),e.jsxs("div",{className:"mt-2 flex flex-col items-center gap-4",children:[V?e.jsxs("div",{className:"relative w-full h-48",children:[e.jsx("img",{src:V,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}),e.jsx(b,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-8 w-8",onClick:()=>{B(null),r(null)},children:"×"})]}):e.jsx("div",{className:"w-full h-48 border-2 border-dashed rounded-lg flex flex-col items-center justify-center bg-muted/50 hover:bg-muted transition-colors",children:e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer text-center p-4 w-full h-full flex flex-col items-center justify-center",children:[e.jsx(ye,{className:"w-8 h-8 mb-2 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click to upload image"}),e.jsx("span",{className:"text-xs text-muted-foreground mt-1",children:"(Max size: 5MB)"})]})}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:I})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",children:"Pet Name*"}),e.jsx(x,{id:"name",value:i.name,onChange:a=>n({...i,name:a.target.value}),required:!0,placeholder:"Enter pet name"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"type",children:"Type*"}),e.jsxs(be,{value:i.type,onValueChange:a=>n({...i,type:a}),required:!0,children:[e.jsx(Ne,{children:e.jsx(we,{placeholder:"Select type"})}),e.jsxs(Ce,{children:[e.jsx(G,{value:"dog",children:"Dog"}),e.jsx(G,{value:"cat",children:"Cat"}),e.jsx(G,{value:"bird",children:"Bird"}),e.jsx(G,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"breed",children:"Breed"}),e.jsx(x,{id:"breed",value:i.breed,onChange:a=>n({...i,breed:a.target.value}),placeholder:"Enter breed"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"birthday",children:"Birthday"}),e.jsx(x,{id:"birthday",type:"date",value:i.birthday,onChange:a=>n({...i,birthday:a.target.value}),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"gender",children:"Gender"}),e.jsxs(be,{value:i.gender,onValueChange:a=>n({...i,gender:a}),children:[e.jsx(Ne,{children:e.jsx(we,{placeholder:"Select gender"})}),e.jsxs(Ce,{children:[e.jsx(G,{value:"male",children:"Male"}),e.jsx(G,{value:"female",children:"Female"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"color",children:"Color"}),e.jsx(x,{id:"color",value:i.color,onChange:a=>n({...i,color:a.target.value}),placeholder:"Enter pet color"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"weight",children:"Weight (kg)"}),e.jsx(x,{id:"weight",type:"number",value:i.weight_kg,onChange:a=>n({...i,weight_kg:parseFloat(a.target.value)}),placeholder:"Enter pet weight",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"microchip",children:"Microchip ID"}),e.jsx(x,{id:"microchip",value:i.microchip_id,onChange:a=>n({...i,microchip_id:a.target.value}),placeholder:"Enter microchip ID"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"notes",children:"Notes"}),e.jsx(J,{id:"notes",value:i.notes,onChange:a=>n({...i,notes:a.target.value}),placeholder:"Enter additional notes"})]})]})]}),e.jsx(qe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Medical Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"blood_type",children:"Blood Type"}),e.jsx(x,{id:"blood_type",value:i.medical_info.blood_type,onChange:a=>n({...i,medical_info:{...i.medical_info,blood_type:a.target.value}}),placeholder:"Enter blood type"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Medical Conditions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.medical_info.conditions.map((a,c)=>e.jsxs(H,{variant:"secondary",className:"gap-2",children:[a,e.jsx("button",{type:"button",onClick:()=>L("conditions",c),className:"text-xs hover:text-destructive",children:"×"})]},c))}),e.jsx(x,{placeholder:"Add condition and press Enter",onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),w("conditions",a.target.value),a.target.value="")}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Allergies"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.medical_info.allergies.map((a,c)=>e.jsxs(H,{variant:"secondary",className:"gap-2",children:[a,e.jsx("button",{type:"button",onClick:()=>L("allergies",c),className:"text-xs hover:text-destructive",children:"×"})]},c))}),e.jsx(x,{placeholder:"Add allergy and press Enter",onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),w("allergies",a.target.value),a.target.value="")}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Current Medications"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.medical_info.medications.map((a,c)=>e.jsxs(H,{variant:"secondary",className:"gap-2",children:[a,e.jsx("button",{type:"button",onClick:()=>L("medications",c),className:"text-xs hover:text-destructive",children:"×"})]},c))}),e.jsx(x,{placeholder:"Add medication and press Enter",onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),w("medications",a.target.value),a.target.value="")}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(l,{children:"Vaccinations"}),e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:R,children:"Add Vaccination"})]}),e.jsx("div",{className:"space-y-4",children:i.medical_info.vaccinations.map((a,c)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start p-4 border rounded-lg relative",children:[e.jsx(b,{type:"button",variant:"ghost",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-destructive text-white hover:bg-destructive/90",onClick:()=>z(c),children:"×"}),e.jsxs("div",{children:[e.jsx(l,{children:"Name"}),e.jsx(x,{value:a.name,onChange:g=>{const y=[...i.medical_info.vaccinations];y[c]={...a,name:g.target.value},n({...i,medical_info:{...i.medical_info,vaccinations:y}})},placeholder:"Vaccination name"})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Date"}),e.jsx(x,{type:"date",value:a.date,max:new Date().toISOString().split("T")[0],onChange:g=>{const y=[...i.medical_info.vaccinations];y[c]={...a,date:g.target.value},n({...i,medical_info:{...i.medical_info,vaccinations:y}})}})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Next Due"}),e.jsx(x,{type:"date",value:a.next_due,min:new Date().toISOString().split("T")[0],onChange:g=>{const y=[...i.medical_info.vaccinations];y[c]={...a,next_due:g.target.value},n({...i,medical_info:{...i.medical_info,vaccinations:y}})}})]})]},c))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{children:"Veterinarian Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_name",children:"Name"}),e.jsx(x,{id:"vet_name",value:i.medical_info.veterinarian.name,onChange:a=>n({...i,medical_info:{...i.medical_info,veterinarian:{...i.medical_info.veterinarian,name:a.target.value}}}),placeholder:"Veterinarian name"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_phone",children:"Phone"}),e.jsx(x,{id:"vet_phone",value:i.medical_info.veterinarian.phone,onChange:a=>n({...i,medical_info:{...i.medical_info,veterinarian:{...i.medical_info.veterinarian,phone:a.target.value}}}),placeholder:"Veterinarian phone"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_email",children:"Email"}),e.jsx(x,{id:"vet_email",type:"email",value:i.medical_info.veterinarian.email,onChange:a=>n({...i,medical_info:{...i.medical_info,veterinarian:{...i.medical_info.veterinarian,email:a.target.value}}}),placeholder:"Veterinarian email"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_clinic",children:"Clinic"}),e.jsx(x,{id:"vet_clinic",value:i.medical_info.veterinarian.clinic,onChange:a=>n({...i,medical_info:{...i.medical_info,veterinarian:{...i.medical_info.veterinarian,clinic:a.target.value}}}),placeholder:"Clinic name"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_specialization",children:"Specialization"}),e.jsx(x,{id:"vet_specialization",value:i.medical_info.veterinarian.specialization,onChange:a=>n({...i,medical_info:{...i.medical_info,veterinarian:{...i.medical_info.veterinarian,specialization:a.target.value}}}),placeholder:"Specialization"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_license_number",children:"License Number"}),e.jsx(x,{id:"vet_license_number",value:i.medical_info.veterinarian.license_number,onChange:a=>n({...i,medical_info:{...i.medical_info,veterinarian:{...i.medical_info.veterinarian,license_number:a.target.value}}}),placeholder:"License Number"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_address",children:"Clinic Address"}),e.jsx(J,{id:"vet_address",value:i.medical_info.veterinarian.address,onChange:a=>n({...i,medical_info:{...i.medical_info,veterinarian:{...i.medical_info.veterinarian,address:a.target.value}}}),placeholder:"Clinic address"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"last_checkup",children:"Last Checkup"}),e.jsx(x,{id:"last_checkup",type:"date",value:i.medical_info.last_checkup,onChange:a=>n({...i,medical_info:{...i.medical_info,last_checkup:a.target.value}}),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"next_checkup",children:"Next Checkup"}),e.jsx(x,{id:"next_checkup",type:"date",value:i.medical_info.next_checkup,onChange:a=>n({...i,medical_info:{...i.medical_info,next_checkup:a.target.value}}),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"medical_notes",children:"Medical Notes"}),e.jsx(J,{id:"medical_notes",value:i.medical_info.medical_notes,onChange:a=>n({...i,medical_info:{...i.medical_info,medical_notes:a.target.value}}),placeholder:"Enter medical notes"})]})]})]}),e.jsx(qe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Emergency Contact"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"emergency_name",children:"Name"}),e.jsx(x,{id:"emergency_name",value:i.emergency_contact.name,onChange:a=>n({...i,emergency_contact:{...i.emergency_contact,name:a.target.value}}),placeholder:"Contact name"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"emergency_relationship",children:"Relationship"}),e.jsx(x,{id:"emergency_relationship",value:i.emergency_contact.relationship,onChange:a=>n({...i,emergency_contact:{...i.emergency_contact,relationship:a.target.value}}),placeholder:"e.g. Family member, Friend"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"emergency_phone",children:"Phone"}),e.jsx(x,{id:"emergency_phone",value:i.emergency_contact.phone,onChange:a=>n({...i,emergency_contact:{...i.emergency_contact,phone:a.target.value}}),placeholder:"Contact phone"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"emergency_email",children:"Email"}),e.jsx(x,{id:"emergency_email",type:"email",value:i.emergency_contact.email,onChange:a=>n({...i,emergency_contact:{...i.emergency_contact,email:a.target.value}}),placeholder:"Contact email"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"emergency_address",children:"Address"}),e.jsx(J,{id:"emergency_address",value:i.emergency_contact.address,onChange:a=>n({...i,emergency_contact:{...i.emergency_contact,address:a.target.value}}),placeholder:"Contact address"})]})]})]}),e.jsxs(_e,{className:"mt-6",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(b,{type:"submit",disabled:_,className:"bg-pet-primary hover:bg-pet-secondary",children:_?"Adding...":"Add Pet"})]})]})]})]})}function Je({petId:t,onImageChange:C,editable:S=!0}){var d,O,U,X;const[_,P]=p.useState([]),[T,M]=p.useState(!0),[B,V]=p.useState(!1),[r,s]=p.useState(!1),[f,i]=p.useState(!1),[n,I]=p.useState(!1),[v,W]=p.useState(null),[R,z]=p.useState(""),[w,L]=p.useState([]),[a,c]=p.useState([]),[g,y]=p.useState(0),{toast:F}=ke(),{t:u}=Te();p.useEffect(()=>{E()},[t]);const E=async()=>{M(!0);try{const{data:h,error:N}=await $.from("pet_images").select("*").eq("pet_id",t).order("is_primary",{ascending:!1}).order("created_at",{ascending:!1});if(N)throw N;P(h||[]);const D=(h==null?void 0:h.findIndex(q=>q.is_primary))||0;y(D>=0?D:0)}catch(h){console.error("Error fetching pet images:",h),F({title:"Error",description:"Failed to load pet images",variant:"destructive"})}finally{M(!1)}},Z=h=>{if(h.target.files){const N=Array.from(h.target.files);L(N);const D=N.map(q=>URL.createObjectURL(q));c(D)}},Y=async()=>{if(w.length!==0){V(!0);try{await na(w,t,_.length===0),s(!1),L([]),c([]),E(),C&&C()}catch(h){console.error("Upload error:",h)}finally{V(!1)}}},o=async h=>{if(!h.is_primary)try{await la(h.id,t),E(),C&&C()}catch(N){console.error("Error setting primary image:",N)}},j=async()=>{if(v)try{await ra(v.id,v.image_url),I(!1),E(),C&&C()}catch(h){console.error("Error deleting image:",h)}},A=async()=>{if(v)try{const{error:h}=await $.from("pet_images").update({caption:R}).eq("id",v.id);if(h)throw h;i(!1),E(),F({title:"Success",description:"Image caption updated successfully"})}catch(h){console.error("Error updating caption:",h),F({title:"Error",description:"Failed to update image caption",variant:"destructive"})}},k=h=>{W(h),z(h.caption||""),i(!0)},m=h=>{W(h),I(!0)};return T?e.jsx("div",{className:"flex justify-center items-center h-48",children:e.jsx(Ae,{size:"md",text:u("petImageGallery.loading")})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-lg overflow-hidden bg-muted/20",children:_.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative aspect-square w-full",children:[e.jsx("img",{src:(d=_[g])==null?void 0:d.image_url,alt:((O=_[g])==null?void 0:O.caption)||"Pet image",className:"w-full h-full object-cover"}),((U=_[g])==null?void 0:U.caption)&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/50 text-white p-2 text-sm",children:(X=_[g])==null?void 0:X.caption})]}),_.length>1&&e.jsx("div",{className:"flex overflow-x-auto gap-2 p-2 bg-muted/10",children:_.map((h,N)=>e.jsxs("div",{className:`relative cursor-pointer flex-shrink-0 ${N===g?"ring-2 ring-primary":""}`,onClick:()=>y(N),children:[e.jsx("img",{src:h.image_url,alt:h.caption||"Thumbnail",className:"w-16 h-16 object-cover rounded"}),h.is_primary&&e.jsx(H,{className:"absolute top-0 right-0 bg-amber-500 text-white",children:e.jsx(Be,{className:"h-3 w-3"})})]},h.id))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 bg-muted/20 rounded-lg",children:[e.jsx(ye,{className:"h-12 w-12 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:u("petImageGallery.noImages")})]})}),S&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>s(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"})," ",u("petImageGallery.addImages")]}),_.length>0&&g!==-1&&e.jsxs(e.Fragment,{children:[!_[g].is_primary&&e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>o(_[g]),children:[e.jsx(Be,{className:"h-4 w-4 mr-2"})," ",u("petImageGallery.setPrimary")]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>k(_[g]),children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"})," ",u("petImageGallery.editCaption")]}),e.jsxs(b,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive border-destructive/30 hover:bg-destructive/10",onClick:()=>m(_[g]),children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"})," ",u("petImageGallery.delete")]})]})]}),e.jsx(ue,{open:r,onOpenChange:s,children:e.jsxs(ge,{children:[e.jsxs(ve,{children:[e.jsx(fe,{children:u("petImageGallery.addDialog.title")}),e.jsx(je,{children:u("petImageGallery.addDialog.description")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"pet-images",children:u("petImageGallery.addDialog.selectImages")}),e.jsx(x,{id:"pet-images",type:"file",accept:"image/*",multiple:!0,onChange:Z,className:"mt-2"})]}),a.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:a.map((h,N)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:h,alt:`Preview ${N+1}`,className:"w-full h-24 object-cover rounded"}),e.jsx(b,{type:"button",variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6",onClick:()=>{c(D=>D.filter((q,K)=>K!==N)),L(D=>D.filter((q,K)=>K!==N))},children:e.jsx(Qe,{className:"h-3 w-3"})})]},N))})]}),e.jsxs(_e,{children:[e.jsx(b,{variant:"outline",onClick:()=>s(!1),children:u("petImageGallery.addDialog.cancel")}),e.jsxs(b,{onClick:Y,disabled:B||w.length===0,children:[B?e.jsx(Ae,{size:"sm",className:"mr-2"}):e.jsx(ye,{className:"h-4 w-4 mr-2"}),u("petImageGallery.addDialog.upload")," ",w.length>0?`(${w.length})`:""]})]})]})}),e.jsx(ue,{open:f,onOpenChange:i,children:e.jsxs(ge,{children:[e.jsxs(ve,{children:[e.jsx(fe,{children:u("petImageGallery.editDialog.title")}),e.jsx(je,{children:u("petImageGallery.editDialog.description")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:v==null?void 0:v.image_url,alt:"Selected image",className:"w-full h-48 object-cover rounded"})}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"caption",children:u("petImageGallery.editDialog.caption")}),e.jsx(J,{id:"caption",value:R,onChange:h=>z(h.target.value),placeholder:u("petImageGallery.editDialog.caption"),className:"mt-2"})]})]}),e.jsxs(_e,{children:[e.jsx(b,{variant:"outline",onClick:()=>i(!1),children:u("petImageGallery.editDialog.cancel")}),e.jsxs(b,{onClick:A,children:[e.jsx(ea,{className:"h-4 w-4 mr-2"})," ",u("petImageGallery.editDialog.save")]})]})]})}),e.jsx(ue,{open:n,onOpenChange:I,children:e.jsxs(ge,{children:[e.jsxs(ve,{children:[e.jsx(fe,{children:u("petImageGallery.deleteDialog.title")}),e.jsxs(je,{children:[u("petImageGallery.deleteDialog.description"),(v==null?void 0:v.is_primary)&&e.jsxs("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded-md",children:[e.jsxs("span",{className:"font-semibold text-amber-700",children:[u("warning"),":"]})," ",u("petImageGallery.deleteDialog.primaryWarning")]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:v==null?void 0:v.image_url,alt:"Image to delete",className:"w-full h-48 object-cover rounded"})}),e.jsxs(_e,{children:[e.jsx(b,{variant:"outline",onClick:()=>I(!1),children:u("petImageGallery.deleteDialog.cancel")}),e.jsxs(b,{variant:"destructive",onClick:j,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"})," ",u("petImageGallery.deleteDialog.delete")]})]})]})})]})}function wa({pet:t,open:C,onOpenChange:S,onSuccess:_}){var n,I,v,W,R,z,w,L,a,c,g,y,F,u,E,Z,Y,o,j,A,k,m;const[P,T]=p.useState(!1),{toast:M}=ke(),[B,V]=p.useState("basic"),{t:r}=Te(),[s,f]=p.useState({name:t.name,type:t.type,breed:t.breed,gender:t.gender,birthday:t.birthday,color:t.color,weight_kg:t.weight_kg,microchip_id:t.microchip_id,notes:t.notes||"",profile_image_url:t.profile_image_url,medical_info:{blood_type:((n=t.medical_info)==null?void 0:n.blood_type)||"",conditions:((I=t.medical_info)==null?void 0:I.conditions)||[],allergies:((v=t.medical_info)==null?void 0:v.allergies)||[],medications:((W=t.medical_info)==null?void 0:W.medications)||[],vaccinations:((R=t.medical_info)==null?void 0:R.vaccinations)||[],last_checkup:((z=t.medical_info)==null?void 0:z.last_checkup)||"",next_checkup:((w=t.medical_info)==null?void 0:w.next_checkup)||"",medical_notes:((L=t.medical_info)==null?void 0:L.medical_notes)||"",veterinarian:{name:((c=(a=t.medical_info)==null?void 0:a.veterinarian)==null?void 0:c.name)||"",phone:((y=(g=t.medical_info)==null?void 0:g.veterinarian)==null?void 0:y.phone)||"",email:((u=(F=t.medical_info)==null?void 0:F.veterinarian)==null?void 0:u.email)||"",clinic:((Z=(E=t.medical_info)==null?void 0:E.veterinarian)==null?void 0:Z.clinic)||"",address:((o=(Y=t.medical_info)==null?void 0:Y.veterinarian)==null?void 0:o.address)||"",specialization:((A=(j=t.medical_info)==null?void 0:j.veterinarian)==null?void 0:A.specialization)||"",license_number:((m=(k=t.medical_info)==null?void 0:k.veterinarian)==null?void 0:m.license_number)||""}}});p.useEffect(()=>{var d,O,U,X,h,N,D,q,K,ee,ae,ie,se,te,ne,le,re,ce,de,oe,me,he;C&&(f({name:t.name||"",type:t.type||"",breed:t.breed||"",gender:t.gender||"",birthday:t.birthday||"",color:t.color||"",weight_kg:t.weight_kg||0,microchip_id:t.microchip_id||"",notes:t.notes||"",profile_image_url:t.profile_image_url,medical_info:{blood_type:((d=t.medical_info)==null?void 0:d.blood_type)||"",conditions:((O=t.medical_info)==null?void 0:O.conditions)||[],allergies:((U=t.medical_info)==null?void 0:U.allergies)||[],medications:((X=t.medical_info)==null?void 0:X.medications)||[],vaccinations:((h=t.medical_info)==null?void 0:h.vaccinations)||[],last_checkup:((N=t.medical_info)==null?void 0:N.last_checkup)||"",next_checkup:((D=t.medical_info)==null?void 0:D.next_checkup)||"",medical_notes:((q=t.medical_info)==null?void 0:q.medical_notes)||"",veterinarian:{name:((ee=(K=t.medical_info)==null?void 0:K.veterinarian)==null?void 0:ee.name)||"",phone:((ie=(ae=t.medical_info)==null?void 0:ae.veterinarian)==null?void 0:ie.phone)||"",email:((te=(se=t.medical_info)==null?void 0:se.veterinarian)==null?void 0:te.email)||"",clinic:((le=(ne=t.medical_info)==null?void 0:ne.veterinarian)==null?void 0:le.clinic)||"",address:((ce=(re=t.medical_info)==null?void 0:re.veterinarian)==null?void 0:ce.address)||"",specialization:((oe=(de=t.medical_info)==null?void 0:de.veterinarian)==null?void 0:oe.specialization)||"",license_number:((he=(me=t.medical_info)==null?void 0:me.veterinarian)==null?void 0:he.license_number)||""}}}),V("basic"))},[t,C]);const i=async d=>{if(d.preventDefault(),!s.name||!s.type){M({title:r("error"),description:r("dashboard.pets.errors.requiredFields"),variant:"destructive"});return}T(!0);try{const O={name:s.name.trim(),type:s.type.toLowerCase(),breed:s.breed.trim()||null,gender:s.gender||null,birthday:s.birthday||null,notes:s.notes.trim()||null,color:s.color||null,weight_kg:s.weight_kg||null,microchip_id:s.microchip_id||null,medical_info:{blood_type:s.medical_info.blood_type||null,conditions:s.medical_info.conditions||null,allergies:s.medical_info.allergies||null,medications:s.medical_info.medications||null,vaccinations:s.medical_info.vaccinations||null,last_checkup:s.medical_info.last_checkup||null,next_checkup:s.medical_info.next_checkup||null,medical_notes:s.medical_info.medical_notes||null,veterinarian:{name:s.medical_info.veterinarian.name||null,phone:s.medical_info.veterinarian.phone||null,email:s.medical_info.veterinarian.email||null,clinic:s.medical_info.veterinarian.clinic||null,address:s.medical_info.veterinarian.address||null,specialization:s.medical_info.veterinarian.specialization||null,license_number:s.medical_info.veterinarian.license_number||null}}},{error:U}=await $.from("pets").update(O).eq("id",t.id);if(U)throw U;M({title:r("success"),description:r("dashboard.pets.success.updated")}),S(!1),_&&_()}catch(O){M({title:r("error"),description:O.message||r("dashboard.pets.errors.update"),variant:"destructive"})}finally{T(!1)}};return e.jsx(ue,{open:C,onOpenChange:S,children:e.jsxs(ge,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[600px]",children:[e.jsxs(ve,{children:[e.jsx(fe,{children:r("dashboard.pets.edit.title")}),e.jsx(je,{children:r("dashboard.pets.edit.description")})]}),e.jsxs(Xe,{value:B,onValueChange:V,className:"w-full",children:[e.jsxs(Ze,{className:"grid grid-cols-3 mb-4",children:[e.jsx(Q,{value:"basic",children:r("dashboard.pets.edit.tabs.basic")}),e.jsx(Q,{value:"images",children:r("dashboard.pets.edit.tabs.images")}),e.jsx(Q,{value:"details",children:r("dashboard.pets.edit.tabs.details")})]}),e.jsxs("form",{onSubmit:i,children:[e.jsx(Ie,{value:"basic",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsxs(l,{htmlFor:"name",children:[r("dashboard.pets.edit.name"),"*"]}),e.jsx(x,{id:"name",value:s.name,onChange:d=>f({...s,name:d.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsxs(l,{htmlFor:"type",children:[r("dashboard.pets.edit.type"),"*"]}),e.jsxs(be,{value:s.type,onValueChange:d=>f({...s,type:d}),children:[e.jsx(Ne,{children:e.jsx(we,{})}),e.jsxs(Ce,{children:[e.jsx(G,{value:"dog",children:r("dashboard.pets.types.dog")}),e.jsx(G,{value:"cat",children:r("dashboard.pets.types.cat")}),e.jsx(G,{value:"bird",children:r("dashboard.pets.types.bird")}),e.jsx(G,{value:"other",children:r("dashboard.pets.types.other")})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"breed",children:r("dashboard.pets.edit.breed")}),e.jsx(x,{id:"breed",value:s.breed,onChange:d=>f({...s,breed:d.target.value})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"gender",children:r("dashboard.pets.edit.gender")}),e.jsxs(be,{value:s.gender,onValueChange:d=>f({...s,gender:d}),children:[e.jsx(Ne,{children:e.jsx(we,{})}),e.jsxs(Ce,{children:[e.jsx(G,{value:"male",children:r("dashboard.pets.genders.male")}),e.jsx(G,{value:"female",children:r("dashboard.pets.genders.female")})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"birthday",children:r("dashboard.pets.edit.birthday")}),e.jsx(x,{id:"birthday",type:"date",value:s.birthday,onChange:d=>f({...s,birthday:d.target.value}),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"color",children:r("dashboard.pets.edit.color")}),e.jsx(x,{id:"color",value:s.color,onChange:d=>f({...s,color:d.target.value})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"weight",children:r("dashboard.pets.edit.weight")}),e.jsx(x,{id:"weight",type:"number",value:s.weight_kg,onChange:d=>f({...s,weight_kg:parseFloat(d.target.value)}),step:"0.1"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"microchip",children:r("dashboard.pets.edit.microchip")}),e.jsx(x,{id:"microchip",value:s.microchip_id,onChange:d=>f({...s,microchip_id:d.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{htmlFor:"notes",children:r("dashboard.pets.edit.notes")}),e.jsx(J,{id:"notes",value:s.notes,onChange:d=>f({...s,notes:d.target.value}),rows:3})]})]})}),e.jsx(Ie,{value:"images",children:e.jsx("div",{className:"space-y-4",children:e.jsx(Je,{petId:t.id,onImageChange:()=>{}})})}),e.jsxs(Ie,{value:"details",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:r("dashboard.pets.edit.medicalInfo")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"blood_type",children:r("dashboard.pets.edit.bloodType")}),e.jsx(x,{id:"blood_type",value:s.medical_info.blood_type,onChange:d=>f({...s,medical_info:{...s.medical_info,blood_type:d.target.value}})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"last_checkup",children:r("dashboard.pets.edit.lastCheckup")}),e.jsx(x,{id:"last_checkup",type:"date",value:s.medical_info.last_checkup,onChange:d=>f({...s,medical_info:{...s.medical_info,last_checkup:d.target.value}}),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"next_checkup",children:r("dashboard.pets.edit.nextCheckup")}),e.jsx(x,{id:"next_checkup",type:"date",value:s.medical_info.next_checkup,onChange:d=>f({...s,medical_info:{...s.medical_info,next_checkup:d.target.value}})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{htmlFor:"medical_notes",children:r("dashboard.pets.edit.medicalNotes")}),e.jsx(J,{id:"medical_notes",value:s.medical_info.medical_notes,onChange:d=>f({...s,medical_info:{...s.medical_info,medical_notes:d.target.value}}),rows:2})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:r("dashboard.pets.edit.veterinarian")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_name",children:r("dashboard.pets.edit.vetName")}),e.jsx(x,{id:"vet_name",value:s.medical_info.veterinarian.name,onChange:d=>f({...s,medical_info:{...s.medical_info,veterinarian:{...s.medical_info.veterinarian,name:d.target.value}}})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_phone",children:r("dashboard.pets.edit.vetPhone")}),e.jsx(x,{id:"vet_phone",value:s.medical_info.veterinarian.phone,onChange:d=>f({...s,medical_info:{...s.medical_info,veterinarian:{...s.medical_info.veterinarian,phone:d.target.value}}})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_email",children:r("dashboard.pets.edit.vetEmail")}),e.jsx(x,{id:"vet_email",type:"email",value:s.medical_info.veterinarian.email,onChange:d=>f({...s,medical_info:{...s.medical_info,veterinarian:{...s.medical_info.veterinarian,email:d.target.value}}})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vet_clinic",children:r("dashboard.pets.edit.vetClinic")}),e.jsx(x,{id:"vet_clinic",value:s.medical_info.veterinarian.clinic,onChange:d=>f({...s,medical_info:{...s.medical_info,veterinarian:{...s.medical_info.veterinarian,clinic:d.target.value}}})})]})]})]})]}),e.jsxs(_e,{className:"mt-6",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>S(!1),children:r("dashboard.pets.edit.cancel")}),e.jsxs(b,{type:"submit",disabled:P,children:[P&&e.jsx(ca,{className:"mr-2 h-4 w-4 animate-spin"}),r("dashboard.pets.edit.save")]})]})]})]})]})})}const Wa=()=>{const[t,C]=p.useState([]),[S,_]=p.useState(!0),{toast:P}=ke(),[T,M]=p.useState(null),[B,V]=p.useState(!1),[r,s]=p.useState(null),[f,i]=p.useState(!1),[n,I]=p.useState(null),[v,W]=p.useState(""),[R,z]=p.useState([]),[w,L]=p.useState("all"),{t:a}=Te(),c=async()=>{try{const{data:{user:o}}=await $.auth.getUser();if(!o)return;const{data:j,error:A}=await $.from("pets").select("*").eq("owner_id",o.id);if(A)throw A;const k=j==null?void 0:j.map(m=>{var d,O,U,X,h,N,D,q,K,ee,ae,ie,se,te,ne,le,re,ce,de,oe,me,he,ze,Le,Oe,Ge,Me;return{...m,profile_image_url:m.profile_image_url||null,breed:m.breed||"",birthday:m.birthday||"",color:m.color||"",gender:m.gender||"",microchip_id:m.microchip_id||"",weight_kg:m.weight_kg||0,scan_count:m.scan_count||0,last_scanned_at:m.last_scanned_at||"",medical_info:{blood_type:((d=m.medical_info)==null?void 0:d.blood_type)||"",conditions:((O=m.medical_info)==null?void 0:O.conditions)||[],allergies:((U=m.medical_info)==null?void 0:U.allergies)||[],medications:((X=m.medical_info)==null?void 0:X.medications)||[],vaccinations:((h=m.medical_info)==null?void 0:h.vaccinations)||[],last_checkup:((N=m.medical_info)==null?void 0:N.last_checkup)||"",next_checkup:((D=m.medical_info)==null?void 0:D.next_checkup)||"",medical_notes:((q=m.medical_info)==null?void 0:q.medical_notes)||"",veterinarian:{name:((ee=(K=m.medical_info)==null?void 0:K.veterinarian)==null?void 0:ee.name)||"",phone:((ie=(ae=m.medical_info)==null?void 0:ae.veterinarian)==null?void 0:ie.phone)||"",email:((te=(se=m.medical_info)==null?void 0:se.veterinarian)==null?void 0:te.email)||"",clinic:((le=(ne=m.medical_info)==null?void 0:ne.veterinarian)==null?void 0:le.clinic)||"",address:((ce=(re=m.medical_info)==null?void 0:re.veterinarian)==null?void 0:ce.address)||"",specialization:((oe=(de=m.medical_info)==null?void 0:de.veterinarian)==null?void 0:oe.specialization)||"",license_number:((he=(me=m.medical_info)==null?void 0:me.veterinarian)==null?void 0:he.license_number)||""}},emergency_contact:{name:((ze=m.emergency_contact)==null?void 0:ze.name)||"",phone:((Le=m.emergency_contact)==null?void 0:Le.phone)||"",email:((Oe=m.emergency_contact)==null?void 0:Oe.email)||"",relationship:((Ge=m.emergency_contact)==null?void 0:Ge.relationship)||"",address:((Me=m.emergency_contact)==null?void 0:Me.address)||""}}});C(k||[]),k&&k.length===1&&I(k[0])}catch(o){console.error("Error fetching pets:",o),P({title:a("error"),description:a("dashboard.pets.errors.fetch"),variant:"destructive"})}finally{_(!1)}},g=async()=>{if(r){_(!0);try{const{data:o,error:j}=await $.from("pet_images").select("*").eq("pet_id",r.id);if(j)throw j;if(o&&o.length>0)for(const k of o)try{const m=k.image_url.split("/"),d=m[m.indexOf("pets")+1];await $.storage.from("pet-images").remove([`pets/${d}`])}catch(m){console.error("Error deleting image:",m)}const{error:A}=await $.from("pets").delete().eq("id",r.id);if(A)throw A;P({title:a("success"),description:a("dashboard.pets.success.deleted")}),(n==null?void 0:n.id)===r.id&&I(null),c()}catch(o){P({title:a("error"),description:o.message||a("dashboard.pets.errors.delete"),variant:"destructive"})}finally{_(!1),s(null),i(!1)}}},y=o=>{s(o),i(!0)},F=o=>{M(o),V(!0)},u=o=>{const j=`${window.location.origin}/pet/${o}`;navigator.clipboard.writeText(j),P({title:a("success"),description:a("dashboard.pets.success.copied")})},E=o=>{W(o.target.value)};p.useEffect(()=>{c()},[]),p.useEffect(()=>{if(v.trim()==="")z(t);else{const o=t.filter(j=>j.name.toLowerCase().includes(v.toLowerCase())||j.type.toLowerCase().includes(v.toLowerCase())||j.breed.toLowerCase().includes(v.toLowerCase()));z(o)}},[v,t]),p.useEffect(()=>{if(w==="all")z(t);else{const o=t.filter(j=>j.type.toLowerCase()===w.toLowerCase());z(o)}},[w,t]);const Z=o=>o?new Date(o).toLocaleDateString():a("dashboard.pets.notAvailable"),Y=o=>{if(!o)return null;const j=new Date(o),A=new Date;let k=A.getFullYear()-j.getFullYear(),m=A.getMonth()-j.getMonth();return m<0&&(k--,m+=12),k>0?`${k} ${a(k===1?"dashboard.pets.year":"dashboard.pets.years")}`:`${m} ${a(m===1?"dashboard.pets.month":"dashboard.pets.months")}`};return e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:a("dashboard.pets.title")}),e.jsx("p",{className:"text-muted-foreground",children:a("dashboard.pets.description")})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx(Ee,{onSuccess:c})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs(xe,{children:[e.jsxs(De,{className:"pb-3",children:[e.jsx(Se,{children:a("dashboard.pets.yourPets")}),e.jsx(Ve,{children:t.length>0?a("dashboard.pets.selectPet"):a("dashboard.pets.noPetsYet")}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx($e,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:a("dashboard.pets.search"),className:"pl-8",value:v,onChange:E})]})]}),e.jsxs(pe,{className:"pb-3",children:[e.jsx(Xe,{defaultValue:"all",value:w,onValueChange:L,className:"w-full",children:e.jsxs(Ze,{className:"w-full mb-4",children:[e.jsx(Q,{value:"all",className:"flex-1",children:a("dashboard.pets.all")}),e.jsx(Q,{value:"dog",className:"flex-1",children:a("dashboard.pets.dogs")}),e.jsx(Q,{value:"cat",className:"flex-1",children:a("dashboard.pets.cats")}),e.jsx(Q,{value:"other",className:"flex-1",children:a("dashboard.pets.others")})]})}),S?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((o,j)=>e.jsxs("div",{className:"flex items-center gap-3 p-2",children:[e.jsx(Fe,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Fe,{className:"h-4 w-24"}),e.jsx(Fe,{className:"h-3 w-16"})]})]},j))}):e.jsx("div",{className:"space-y-1",children:R.length>0?R.map(o=>e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-md cursor-pointer transition-colors ${(n==null?void 0:n.id)===o.id?"bg-primary/10 hover:bg-primary/15":"hover:bg-muted"}`,onClick:()=>I(o),children:[e.jsx(da,{src:o.profile_image_url,fallback:o.name.charAt(0),size:"md",petType:o.type}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:o.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:o.breed||o.type.charAt(0).toUpperCase()+o.type.slice(1)})]})]},o.id)):e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:a(v?"dashboard.pets.noMatchingPets":"dashboard.pets.noPetsFound")})})]}),t.length===0&&!S&&e.jsx(Ue,{className:"pt-0",children:e.jsxs("div",{className:"w-full flex flex-col items-center justify-center py-6",children:[e.jsx(Re,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4",children:a("dashboard.pets.emptyState")}),e.jsx(Ee,{onSuccess:c})]})})]})}),e.jsx("div",{className:"lg:col-span-2",children:S?e.jsx(xe,{children:e.jsx(pe,{className:"p-6",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(Ae,{size:"lg",text:a("dashboard.pets.loading")})})})}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(xe,{children:[e.jsx(De,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(Se,{className:"text-2xl",children:n.name}),e.jsxs(Ve,{children:[n.breed||n.type.charAt(0).toUpperCase()+n.type.slice(1),n.birthday&&` • ${Y(n.birthday)}`]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>F(n),children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"})," ",a("dashboard.pets.edit")]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>u(n.id),children:[e.jsx(fa,{className:"h-4 w-4 mr-2"})," ",a("dashboard.pets.share")]})]})]})}),e.jsx(pe,{children:e.jsx(Je,{petId:n.id,onImageChange:c,editable:!0})})]}),e.jsxs(xe,{children:[e.jsx(De,{className:"pb-3",children:e.jsx(Se,{children:a("dashboard.pets.details")})}),e.jsxs(pe,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.gender&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",className:"p-1.5",children:e.jsx(aa,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a("dashboard.pets.gender")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n.gender.charAt(0).toUpperCase()+n.gender.slice(1)})]})]}),n.color&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",className:"p-1.5",children:e.jsx(ja,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a("dashboard.pets.color")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n.color})]})]}),n.birthday&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",className:"p-1.5",children:e.jsx(ya,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a("dashboard.pets.birthday")}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[Z(n.birthday),Y(n.birthday)&&` (${Y(n.birthday)})`]})]})]}),n.weight_kg>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",className:"p-1.5",children:e.jsx(ba,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a("dashboard.pets.weight")}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n.weight_kg," kg"]})]})]}),n.microchip_id&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",className:"p-1.5",children:e.jsx(ia,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a("dashboard.pets.microchip")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n.microchip_id})]})]}),n.scan_count>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",className:"p-1.5",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a("dashboard.pets.scans")}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n.scan_count," ",n.scan_count===1?a("dashboard.pets.scan"):a("dashboard.pets.scans"),n.last_scanned_at&&` • ${a("dashboard.pets.lastScan")}: ${Z(n.last_scanned_at)}`]})]})]})]}),n.notes&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_a,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h3",{className:"font-medium",children:a("dashboard.pets.notes")})]}),e.jsx("div",{className:"text-sm text-muted-foreground bg-muted/30 p-3 rounded-md",children:n.notes})]})]}),e.jsx(Ue,{className:"border-t pt-6",children:e.jsxs(b,{variant:"destructive",className:"w-full sm:w-auto",onClick:()=>y(n),children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"})," ",a("dashboard.pets.delete")]})})]})]}):e.jsx(xe,{children:e.jsx(pe,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(Re,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-medium mb-2",children:a("dashboard.pets.selectPetPrompt")}),e.jsx("p",{className:"text-muted-foreground mb-6",children:a("dashboard.pets.selectPetDescription")}),t.length===0&&e.jsx(Ee,{onSuccess:c})]})})})})]}),T&&e.jsx(wa,{pet:T,open:B,onOpenChange:V,onSuccess:c}),e.jsx(oa,{open:f,onOpenChange:i,children:e.jsxs(ma,{children:[e.jsxs(ha,{children:[e.jsx(xa,{children:a("dashboard.pets.deleteDialog.title")}),e.jsx(pa,{children:a("dashboard.pets.deleteDialog.description")})]}),e.jsxs(ua,{children:[e.jsx(ga,{onClick:()=>s(null),children:a("dashboard.pets.deleteDialog.cancel")}),e.jsx(va,{className:"bg-red-500 hover:bg-red-600 text-white",onClick:g,children:a("dashboard.pets.deleteDialog.confirm")})]})]})})]})};export{Wa as default};
