import{j as e}from"./ui-DskC_GZ4.js";import{r as t}from"./vendor-BlHcAAdO.js";import{c as le,K as re,T as S,O as te,P as x,R as g,ag as ne,ah as ie,B as n,ai as de,aj as ce,ak as k,al as oe,t as me}from"./index-fU-TRYU7.js";import{C as he}from"./card-BKNPTKQ9.js";import{D as F,b as E,c as L,d as T,e as A,f as M}from"./dialog-D6ZzA_3-.js";import{T as xe,a as je,b as P,c as o,d as ue,e as i}from"./table-dY4MnRiV.js";import{S as v,a as N,b,c as y,d as r}from"./select-CjVjgBc2.js";import{P as pe,M as fe}from"./phone-zyjSBqy0.js";import{E as ge}from"./ellipsis-vertical-ZZDI0_RD.js";import{E as ve}from"./eye-hBmQ-Y1Y.js";import{T as Ne}from"./trash-2-C636hku7.js";import{f as be}from"./format-cwXK75ha.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=le("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),Pe=()=>{const{toast:m}=re(),[B,H]=t.useState([]),[z,R]=t.useState(!0),[d,q]=t.useState(""),[w,J]=t.useState(null),[_,Q]=t.useState(null),[a,U]=t.useState(null),[K,j]=t.useState(!1),[G,u]=t.useState(!1),[W,p]=t.useState(!1),[l,c]=t.useState({first_name:"",last_name:"",email:"",phone:"",role:"",plan:""});t.useEffect(()=>{D()},[]);const D=async()=>{R(!0);try{const{data:s,error:h}=await S.from("users").select("*").order("created_at",{ascending:!1});if(h)throw h;H(s||[])}catch(s){console.error("Error fetching users:",s),m({title:"Error",description:"Failed to load users",variant:"destructive"})}finally{R(!1)}},X=s=>{U(s),j(!0)},O=s=>{U(s),c({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email,phone:s.phone||"",role:s.role,plan:s.plan}),u(!0)},Y=s=>{U(s),p(!0)},Z=async()=>{if(a)try{const{error:s}=await S.from("users").update({first_name:l.first_name,last_name:l.last_name,phone:l.phone,role:l.role,plan:l.plan}).eq("id",a.id);if(s)throw s;m({title:"User Updated",description:"User information has been updated successfully"}),u(!1),D()}catch(s){console.error("Error updating user:",s),m({title:"Update Failed",description:"Failed to update user information",variant:"destructive"})}},ee=async()=>{if(a)try{const{error:s}=await S.from("users").delete().eq("id",a.id);if(s)throw s;m({title:"User Deleted",description:"User has been deleted successfully"}),p(!1),D()}catch(s){console.error("Error deleting user:",s),m({title:"Delete Failed",description:"Failed to delete user",variant:"destructive"})}},f=s=>{if(!s)return"Never";try{return be(new Date(s),"MMM dd, yyyy HH:mm")}catch{return"Invalid date"}},V=s=>{switch(s.toLowerCase()){case"admin":return"bg-red-100 text-red-800 border-red-200";case"staff":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},$=s=>{switch(s.toLowerCase()){case"rescue":return"bg-purple-100 text-purple-800 border-purple-200";case"comfort":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},I=B.filter(s=>{const h=!d||s.email.toLowerCase().includes(d.toLowerCase())||s.first_name&&s.first_name.toLowerCase().includes(d.toLowerCase())||s.last_name&&s.last_name.toLowerCase().includes(d.toLowerCase())||s.phone&&s.phone.includes(d),se=!w||s.role===w,ae=!_||s.plan===_;return h&&se&&ae});return e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"User Management"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(te,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search users by name, email or phone...",className:"pl-10",value:d,onChange:s=>q(s.target.value)})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(v,{value:w||"all",onValueChange:s=>J(s==="all"?null:s),children:[e.jsx(N,{className:"w-[150px]",children:e.jsx(b,{placeholder:"Filter by role"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Roles"}),e.jsx(r,{value:"admin",children:"Admin"}),e.jsx(r,{value:"staff",children:"Staff"}),e.jsx(r,{value:"user",children:"User"})]})]}),e.jsxs(v,{value:_||"all",onValueChange:s=>Q(s==="all"?null:s),children:[e.jsx(N,{className:"w-[150px]",children:e.jsx(b,{placeholder:"Filter by plan"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Plans"}),e.jsx(r,{value:"free",children:"Free"}),e.jsx(r,{value:"comfort",children:"Comfort"}),e.jsx(r,{value:"rescue",children:"Rescue+"})]})]})]})]}),e.jsx(he,{children:z?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-pet-primary"})}):e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs(P,{children:[e.jsx(o,{children:"User"}),e.jsx(o,{children:"Contact"}),e.jsx(o,{children:"Role & Plan"}),e.jsx(o,{children:"Joined"}),e.jsx(o,{children:"Last Active"}),e.jsx(o,{className:"text-right",children:"Actions"})]})}),e.jsx(ue,{children:I.length===0?e.jsx(P,{children:e.jsx(i,{colSpan:6,className:"text-center py-8",children:"No users found matching your filters"})}):I.map(s=>e.jsxs(P,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:`${s.first_name||""} ${s.last_name||""}`,className:"w-full h-full rounded-full object-cover"}):e.jsx(C,{size:20,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.first_name||s.last_name?`${s.first_name||""} ${s.last_name||""}`:"Unnamed User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex flex-col",children:[s.phone&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(pe,{size:14,className:"mr-1"}),s.phone]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(fe,{size:14,className:"mr-1"}),s.email]})]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(g,{className:`${V(s.role)}`,children:s.role.charAt(0).toUpperCase()+s.role.slice(1)}),e.jsxs(g,{className:`block ${$(s.plan)}`,children:[s.plan.charAt(0).toUpperCase()+s.plan.slice(1)," Plan"]})]})}),e.jsx(i,{children:f(s.created_at)}),e.jsx(i,{children:f(s.last_login)}),e.jsx(i,{className:"text-right",children:e.jsxs(ne,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(n,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ge,{className:"h-4 w-4"})]})}),e.jsxs(de,{align:"end",children:[e.jsx(ce,{children:"Actions"}),e.jsxs(k,{onClick:()=>X(s),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"View details"]}),e.jsxs(k,{onClick:()=>O(s),children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Edit user"]}),e.jsx(oe,{}),e.jsxs(k,{className:"text-red-600",onClick:()=>Y(s),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Delete user"]})]})]})})]},s.id))})]})}),e.jsx(F,{open:K,onOpenChange:j,children:e.jsxs(E,{className:"max-w-md",children:[e.jsxs(L,{children:[e.jsx(T,{children:"User Details"}),e.jsx(A,{children:"Detailed information about this user."})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center",children:a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:`${a.first_name||""} ${a.last_name||""}`,className:"w-full h-full rounded-full object-cover"}):e.jsx(C,{size:36,className:"text-gray-500"})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"First Name"}),e.jsx("p",{children:a.first_name||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Name"}),e.jsx("p",{children:a.last_name||"Not provided"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{children:a.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{children:a.phone||"Not provided"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Role"}),e.jsx(g,{className:V(a.role),children:a.role.charAt(0).toUpperCase()+a.role.slice(1)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan"}),e.jsx(g,{className:$(a.plan),children:a.plan.charAt(0).toUpperCase()+a.plan.slice(1)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Joined"}),e.jsx("p",{children:f(a.created_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Login"}),e.jsx("p",{children:f(a.last_login)})]})]})]}),e.jsxs(M,{children:[e.jsx(n,{onClick:()=>j(!1),children:"Close"}),e.jsx(n,{variant:"outline",onClick:()=>{j(!1),a&&O(a)},children:"Edit User"})]})]})}),e.jsx(F,{open:G,onOpenChange:u,children:e.jsxs(E,{className:"max-w-md",children:[e.jsxs(L,{children:[e.jsx(T,{children:"Edit User"}),e.jsx(A,{children:"Update user information and permissions."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"first_name",className:"text-sm font-medium",children:"First Name"}),e.jsx(x,{id:"first_name",value:l.first_name,onChange:s=>c({...l,first_name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"last_name",className:"text-sm font-medium",children:"Last Name"}),e.jsx(x,{id:"last_name",value:l.last_name,onChange:s=>c({...l,last_name:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email"}),e.jsx(x,{id:"email",type:"email",value:l.email,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email address cannot be changed."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"phone",className:"text-sm font-medium",children:"Phone"}),e.jsx(x,{id:"phone",value:l.phone,onChange:s=>c({...l,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"role",className:"text-sm font-medium",children:"Role"}),e.jsxs(v,{value:l.role,onValueChange:s=>c({...l,role:s}),children:[e.jsx(N,{id:"role",children:e.jsx(b,{placeholder:"Select role"})}),e.jsxs(y,{children:[e.jsx(r,{value:"admin",children:"Admin"}),e.jsx(r,{value:"staff",children:"Staff"}),e.jsx(r,{value:"user",children:"User"})]})]}),l.role==="admin"&&e.jsxs("div",{className:"flex items-center mt-2 p-2 bg-amber-50 border border-amber-200 rounded text-amber-800",children:[e.jsx(me,{className:"h-4 w-4 mr-2 text-amber-500"}),e.jsx("p",{className:"text-xs",children:"Admin users have full access to all system features."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"plan",className:"text-sm font-medium",children:"Subscription Plan"}),e.jsxs(v,{value:l.plan,onValueChange:s=>c({...l,plan:s}),children:[e.jsx(N,{id:"plan",children:e.jsx(b,{placeholder:"Select plan"})}),e.jsxs(y,{children:[e.jsx(r,{value:"free",children:"Free"}),e.jsx(r,{value:"comfort",children:"Comfort"}),e.jsx(r,{value:"rescue",children:"Rescue+"})]})]})]})]}),e.jsxs(M,{children:[e.jsx(n,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(n,{onClick:Z,children:"Save Changes"})]})]})}),e.jsx(F,{open:W,onOpenChange:p,children:e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsx(T,{children:"Confirm Deletion"}),e.jsx(A,{children:"Are you sure you want to delete this user? This action cannot be undone."})]}),a&&e.jsxs("div",{className:"flex items-center p-4 bg-red-50 border border-red-200 rounded",children:[e.jsx(C,{className:"h-6 w-6 mr-4 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.first_name||a.last_name?`${a.first_name||""} ${a.last_name||""}`:"Unnamed User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.email})]})]}),e.jsxs(M,{children:[e.jsx(n,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:ee,children:"Delete User"})]})]})})]})};export{Pe as default};
