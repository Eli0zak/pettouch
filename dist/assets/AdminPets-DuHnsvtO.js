import{j as e}from"./ui-DskC_GZ4.js";import{r as n}from"./vendor-BlHcAAdO.js";import{af as W,T as q,B as d,O as J,P as K,R as m,a2 as A}from"./index-fU-TRYU7.js";import{C as X}from"./card-BKNPTKQ9.js";import{T as Y,a as Z,b as p,c as l,d as ee,e as r}from"./table-dY4MnRiV.js";import{S as O,a as L,b as V,c as I,d as i}from"./select-CjVjgBc2.js";import{D as se,b as ae,c as te,d as ne,e as re,f as ie}from"./dialog-D6ZzA_3-.js";import{P as k}from"./pet-avatar-CuQyVzr2.js";import{R as le}from"./refresh-cw-_XOA-msa.js";import{E as ce}from"./eye-hBmQ-Y1Y.js";import{f as de}from"./format-cwXK75ha.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";import"./paw-print-nX1O6nEh.js";const be=()=>{var _,y,b,C,S;const{toast:B}=W(),[E,F]=n.useState([]),[R,v]=n.useState(!0),[x,U]=n.useState(""),[h,H]=n.useState(null),[o,M]=n.useState(null),[a,$]=n.useState(null),[z,j]=n.useState(!1);n.useEffect(()=>{g()},[]);const g=async()=>{try{v(!0);const{data:s,error:t}=await q.from("pets").select(`
          *,
          owner:owner_id(
            first_name,
            last_name,
            email
          )
        `).order("created_at",{ascending:!1});if(t)throw t;if(s){const f=s.map(c=>({...c,scan_count:c.scan_count||0,last_scanned_at:c.last_scanned_at||null,medical_info:c.medical_info||null}));F(f)}}catch(s){console.error("Error fetching pets:",s),B({title:"Error",description:s.message||"Failed to fetch pets",variant:"destructive"})}finally{v(!1)}},Q=s=>{$(s),j(!0)},w=s=>{window.open(`/admin/users/${s}`,"_blank")},u=s=>{if(!s)return"Never";try{return de(new Date(s),"MMM dd, yyyy HH:mm")}catch{return"Invalid date"}},N=E.filter(s=>{var T,D,P;const t=x.toLowerCase(),f=!x||s.name.toLowerCase().includes(t)||s.breed&&s.breed.toLowerCase().includes(t)||((T=s.owner)==null?void 0:T.email)&&s.owner.email.toLowerCase().includes(t)||((D=s.owner)==null?void 0:D.first_name)&&s.owner.first_name.toLowerCase().includes(t)||((P=s.owner)==null?void 0:P.last_name)&&s.owner.last_name.toLowerCase().includes(t),c=!h||s.type===h,G=!o||o==="active"&&s.is_active||o==="inactive"&&!s.is_active;return f&&c&&G});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Pets Management"}),e.jsxs(d,{onClick:g,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(J,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"Search by pet name, breed, or owner info...",className:"pl-10",value:x,onChange:s=>U(s.target.value)})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(O,{value:h||"all",onValueChange:s=>H(s==="all"?null:s),children:[e.jsx(L,{className:"w-[150px]",children:e.jsx(V,{placeholder:"Pet Type"})}),e.jsxs(I,{children:[e.jsx(i,{value:"all",children:"All Types"}),e.jsx(i,{value:"dog",children:"Dogs"}),e.jsx(i,{value:"cat",children:"Cats"}),e.jsx(i,{value:"bird",children:"Birds"}),e.jsx(i,{value:"other",children:"Other"})]})]}),e.jsxs(O,{value:o||"all",onValueChange:s=>M(s==="all"?null:s),children:[e.jsx(L,{className:"w-[150px]",children:e.jsx(V,{placeholder:"Status"})}),e.jsxs(I,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"active",children:"Active"}),e.jsx(i,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsx(X,{children:R?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-pet-primary"})}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(p,{children:[e.jsx(l,{children:"Pet"}),e.jsx(l,{children:"Owner"}),e.jsx(l,{children:"Type/Breed"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Scans"}),e.jsx(l,{children:"Last Scan"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsx(ee,{children:N.length===0?e.jsx(p,{children:e.jsx(r,{colSpan:7,className:"text-center py-8",children:"No pets found matching your filters"})}):N.map(s=>e.jsxs(p,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{src:s.profile_image_url,fallback:s.name.charAt(0),size:"md",petType:s.type}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ID: ",s.id.substring(0,8),"..."]})]})]})}),e.jsx(r,{children:s.owner?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.owner.first_name||s.owner.last_name?`${s.owner.first_name||""} ${s.owner.last_name||""}`.trim():"Unnamed Owner"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.owner.email})]}):e.jsx("p",{className:"text-muted-foreground",children:"No owner data"})}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx(m,{children:s.type.charAt(0).toUpperCase()+s.type.slice(1)}),s.breed&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.breed})]})}),e.jsx(r,{children:e.jsx(m,{variant:s.is_active?"default":"secondary",className:s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:s.is_active?"Active":"Inactive"})}),e.jsx(r,{children:e.jsx("span",{className:"font-medium",children:s.scan_count||0})}),e.jsx(r,{children:u(s.last_scanned_at)}),e.jsx(r,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(d,{variant:"ghost",size:"icon",onClick:()=>Q(s),children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"View"})]}),e.jsxs(d,{variant:"ghost",size:"icon",onClick:()=>w(s.owner_id),children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"View Owner"})]})]})})]},s.id))})]})}),e.jsx(se,{open:z,onOpenChange:j,children:e.jsxs(ae,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsx(ne,{children:"Pet Details"}),e.jsx(re,{children:"Detailed information about this pet."})]}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(k,{src:a.profile_image_url,fallback:a.name.charAt(0),size:"xl",petType:a.type,className:"h-32 w-32"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:a.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ID: ",a.id]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Type"}),e.jsx("p",{children:a.type.charAt(0).toUpperCase()+a.type.slice(1)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Breed"}),e.jsx("p",{children:a.breed||"Not specified"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Gender"}),e.jsx("p",{children:a.gender?a.gender.charAt(0).toUpperCase()+a.gender.slice(1):"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Color"}),e.jsx("p",{children:a.color||"Not specified"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(m,{variant:a.is_active?"default":"secondary",className:a.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:a.is_active?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Scans"}),e.jsx("p",{className:"text-xl font-bold",children:a.scan_count||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Scan"}),e.jsx("p",{children:u(a.last_scanned_at)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Owner"}),a.owner?e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{children:a.owner.first_name||a.owner.last_name?`${a.owner.first_name||""} ${a.owner.last_name||""}`.trim():"Unnamed Owner"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.owner.email})]})]}):e.jsx("p",{children:"No owner data available"})]}),a.medical_info&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Medical Info"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[((_=a.medical_info.conditions)==null?void 0:_.length)>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conditions:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:(y=a.medical_info.conditions)==null?void 0:y.map((s,t)=>e.jsx(m,{variant:"outline",children:s},t))})]}),((b=a.medical_info.vaccinations)==null?void 0:b.length)>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Latest Vaccination:"}),e.jsxs("p",{className:"text-sm",children:[(C=a.medical_info.vaccinations)==null?void 0:C[a.medical_info.vaccinations.length-1].name," ","(",u((S=a.medical_info.vaccinations)==null?void 0:S[a.medical_info.vaccinations.length-1].date),")"]})]})]})]})]}),e.jsxs(ie,{className:"mt-6",children:[e.jsx(d,{onClick:()=>j(!1),children:"Close"}),a&&a.owner&&e.jsx(d,{variant:"outline",onClick:()=>w(a.owner_id),children:"View Owner"})]})]})})]})};export{be as default};
