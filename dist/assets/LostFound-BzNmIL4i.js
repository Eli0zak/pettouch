import{j as e}from"./ui-DskC_GZ4.js";import{r as o}from"./vendor-BlHcAAdO.js";import{K as X,T as p,O as Z,P as i,B as m,Y as n}from"./index-fU-TRYU7.js";import{C as S,b as k,c as A,d as I,a as O,e as B}from"./card-BKNPTKQ9.js";import{T as ee}from"./textarea-Dl2XRPf0.js";import{D as te,a as se,b as ae,c as re,d as le,e as ne,f as ie}from"./dialog-D6ZzA_3-.js";import{S as v,a as N,b,c as y,d as l}from"./select-CjVjgBc2.js";import{b as ce}from"./upload-helper-OLK1PJwh.js";import{P as oe}from"./plus-BQJ1DQBE.js";import{M}from"./map-pin-CaB-Fh_N.js";import{C as w}from"./calendar-BJg_nOUc.js";import{T as de}from"./trash-2-C636hku7.js";import{P as he,M as me}from"./phone-zyjSBqy0.js";import{f as pe}from"./format-cwXK75ha.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";const Le=()=>{const{toast:d}=X(),[Y,$]=o.useState([]),[D,q]=o.useState([]),[V,L]=o.useState(!0),[u,z]=o.useState(""),[C,G]=o.useState("all"),[F,H]=o.useState("all"),[K,x]=o.useState(!1),[a,g]=o.useState({title:"",description:"",pet_name:"",pet_type:"dog",pet_breed:"",pet_color:"",pet_gender:"unknown",pet_age:"",last_seen_location:"",last_seen_date:"",contact_phone:"",contact_email:"",image:null});o.useEffect(()=>{j(),_()},[]);const j=async()=>{L(!0);try{const{data:t,error:s}=await p.from("lost_found_posts").select("*").order("created_at",{ascending:!1});if(s)throw s;const r=t==null?void 0:t.map(h=>({...h,status:h.status}));$(r||[])}catch(t){console.error("Error fetching lost and found posts:",t),d({title:"Error",description:"Failed to load lost and found posts",variant:"destructive"})}finally{L(!1)}},_=async()=>{try{const{data:{user:t}}=await p.auth.getUser();if(!t)return;const{data:s,error:r}=await p.from("lost_found_posts").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(r)throw r;const h=s==null?void 0:s.map(U=>({...U,status:U.status}));q(h||[])}catch(t){console.error("Error fetching user posts:",t)}},c=t=>{const{name:s,value:r}=t.target;g(h=>({...h,[s]:r}))},T=(t,s)=>{g(r=>({...r,[t]:s}))},J=t=>{t.target.files&&t.target.files.length>0&&g(s=>({...s,image:t.target.files[0]}))},Q=async()=>{try{const{data:{user:t}}=await p.auth.getUser();if(!t){d({title:"Authentication Required",description:"You must be logged in to create reports",variant:"destructive"});return}const{data:s,error:r}=await p.from("lost_found_posts").insert({title:a.title,description:a.description,pet_name:a.pet_name||null,pet_type:a.pet_type,pet_breed:a.pet_breed||null,pet_color:a.pet_color||null,pet_gender:a.pet_gender,pet_age:a.pet_age?parseInt(a.pet_age):null,last_seen_location:a.last_seen_location||null,last_seen_date:a.last_seen_date?new Date(a.last_seen_date).toISOString():null,status:"open",contact_phone:a.contact_phone||null,contact_email:a.contact_email||null,user_id:t.id}).select().single();if(r)throw r;a.image&&s&&await ce(a.image,s.id),d({title:"Report Created",description:"Your lost and found report has been created successfully"}),g({title:"",description:"",pet_name:"",pet_type:"dog",pet_breed:"",pet_color:"",pet_gender:"unknown",pet_age:"",last_seen_location:"",last_seen_date:"",contact_phone:"",contact_email:"",image:null}),x(!1),j(),_()}catch(t){console.error("Error creating post:",t),d({title:"Error",description:t.message||"Failed to create your report",variant:"destructive"})}},P=async(t,s)=>{try{const{error:r}=await p.from("lost_found_posts").update({status:s,resolved_at:s==="resolved"?new Date().toISOString():null}).eq("id",t);if(r)throw r;d({title:"Status Updated",description:`Report status has been updated to ${s}`}),j(),_()}catch(r){console.error("Error updating post status:",r),d({title:"Error",description:"Failed to update report status",variant:"destructive"})}},W=async t=>{if(confirm("Are you sure you want to delete this report?"))try{const{error:s}=await p.from("lost_found_posts").delete().eq("id",t);if(s)throw s;d({title:"Report Deleted",description:"Your report has been deleted successfully"}),j(),_()}catch(s){console.error("Error deleting post:",s),d({title:"Error",description:"Failed to delete the report",variant:"destructive"})}},E=Y.filter(t=>{const s=t.title.toLowerCase().includes(u.toLowerCase())||t.description.toLowerCase().includes(u.toLowerCase())||t.pet_name&&t.pet_name.toLowerCase().includes(u.toLowerCase())||t.pet_breed&&t.pet_breed.toLowerCase().includes(u.toLowerCase())||t.last_seen_location&&t.last_seen_location.toLowerCase().includes(u.toLowerCase()),r=C==="all"||t.pet_type===C,h=F==="all"||t.status===F;return s&&r&&h}),f=t=>{if(!t)return"Unknown date";try{return pe(new Date(t),"PPP")}catch{return"Unknown date"}},R=t=>{switch(t){case"open":return"bg-amber-100 text-amber-800 border-amber-200";case"resolved":return"bg-green-100 text-green-800 border-green-200";case"closed":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}};return e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Lost & Found Community"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:"Help reunite lost pets with their owners by reporting lost pets or searching for found ones."}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(i,{placeholder:"Search posts...",className:"pl-10",value:u,onChange:t=>z(t.target.value)})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-40",children:e.jsxs(v,{value:C,onValueChange:t=>G(t),children:[e.jsx(N,{children:e.jsx(b,{placeholder:"Pet Type"})}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"All Types"}),e.jsx(l,{value:"dog",children:"Dog"}),e.jsx(l,{value:"cat",children:"Cat"}),e.jsx(l,{value:"bird",children:"Bird"}),e.jsx(l,{value:"other",children:"Other"})]})]})}),e.jsx("div",{className:"w-40",children:e.jsxs(v,{value:F,onValueChange:t=>H(t),children:[e.jsx(N,{children:e.jsx(b,{placeholder:"Status"})}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"All Status"}),e.jsx(l,{value:"open",children:"Open"}),e.jsx(l,{value:"resolved",children:"Resolved"}),e.jsx(l,{value:"closed",children:"Closed"})]})]})})]})]}),e.jsx("div",{className:"mb-8 flex justify-end",children:e.jsxs(te,{open:K,onOpenChange:x,children:[e.jsx(se,{asChild:!0,children:e.jsxs(m,{children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Report Lost/Found Pet"]})}),e.jsxs(ae,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(le,{children:"Report Lost or Found Pet"}),e.jsx(ne,{children:"Fill out the form below to create a lost or found pet report. The more details you provide, the better chances of reuniting the pet with its owner."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"title",children:"Report Title *"}),e.jsx(i,{id:"title",name:"title",placeholder:"E.g., Lost Golden Retriever in Downtown",value:a.title,onChange:c,required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"description",children:"Description *"}),e.jsx(ee,{id:"description",name:"description",placeholder:"Provide as many details as possible about the pet and the circumstances",value:a.description,onChange:c,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"pet_name",children:"Pet Name"}),e.jsx(i,{id:"pet_name",name:"pet_name",placeholder:"If known",value:a.pet_name,onChange:c})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"pet_type",children:"Pet Type *"}),e.jsxs(v,{name:"pet_type",value:a.pet_type,onValueChange:t=>T("pet_type",t),children:[e.jsx(N,{id:"pet_type",children:e.jsx(b,{placeholder:"Select type"})}),e.jsxs(y,{children:[e.jsx(l,{value:"dog",children:"Dog"}),e.jsx(l,{value:"cat",children:"Cat"}),e.jsx(l,{value:"bird",children:"Bird"}),e.jsx(l,{value:"other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"pet_breed",children:"Breed"}),e.jsx(i,{id:"pet_breed",name:"pet_breed",placeholder:"E.g., Golden Retriever",value:a.pet_breed,onChange:c})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"pet_color",children:"Color"}),e.jsx(i,{id:"pet_color",name:"pet_color",placeholder:"E.g., Golden, Brown",value:a.pet_color,onChange:c})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"pet_gender",children:"Gender"}),e.jsxs(v,{name:"pet_gender",value:a.pet_gender,onValueChange:t=>T("pet_gender",t),children:[e.jsx(N,{id:"pet_gender",children:e.jsx(b,{placeholder:"Select gender"})}),e.jsxs(y,{children:[e.jsx(l,{value:"male",children:"Male"}),e.jsx(l,{value:"female",children:"Female"}),e.jsx(l,{value:"unknown",children:"Unknown"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"pet_age",children:"Age (years)"}),e.jsx(i,{id:"pet_age",name:"pet_age",type:"number",placeholder:"If known",value:a.pet_age,onChange:c})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"last_seen_location",children:"Last Seen Location"}),e.jsx(i,{id:"last_seen_location",name:"last_seen_location",placeholder:"Address or area where the pet was last seen",value:a.last_seen_location,onChange:c})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"last_seen_date",children:"Last Seen Date"}),e.jsx(i,{id:"last_seen_date",name:"last_seen_date",type:"date",value:a.last_seen_date,onChange:c})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"contact_phone",children:"Contact Phone"}),e.jsx(i,{id:"contact_phone",name:"contact_phone",type:"tel",placeholder:"Your contact number",value:a.contact_phone,onChange:c})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"contact_email",children:"Contact Email"}),e.jsx(i,{id:"contact_email",name:"contact_email",type:"email",placeholder:"Your contact email",value:a.contact_email,onChange:c})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"image",children:"Pet Image"}),e.jsx(i,{id:"image",name:"image",type:"file",accept:"image/*",onChange:J}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a clear image of the pet to help with identification"})]})]}),e.jsxs(ie,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(m,{type:"button",onClick:Q,children:"Create Report"})]})]})]})}),D.length>0&&e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Your Reports"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:D.map(t=>{var s,r;return e.jsxs(S,{className:"overflow-hidden",children:[t.image_url&&e.jsx("div",{className:"aspect-video w-full overflow-hidden",children:e.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs(k,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(A,{className:"line-clamp-2",children:t.title}),e.jsx("div",{className:`px-2 py-1 text-xs rounded-full border ${R(t.status)}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx(I,{children:t.pet_type&&t.pet_breed?`${t.pet_type.charAt(0).toUpperCase()+t.pet_type.slice(1)} - ${t.pet_breed}`:((s=t.pet_type)==null?void 0:s.charAt(0).toUpperCase())+((r=t.pet_type)==null?void 0:r.slice(1))})]}),e.jsxs(O,{children:[e.jsx("p",{className:"text-sm line-clamp-3 mb-4",children:t.description}),e.jsxs("div",{className:"flex flex-col space-y-2 text-sm text-muted-foreground",children:[t.last_seen_location&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-3 w-3 mr-2"}),e.jsx("span",{children:t.last_seen_location})]}),t.last_seen_date&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:"h-3 w-3 mr-2"}),e.jsx("span",{children:f(t.last_seen_date)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:"h-3 w-3 mr-2"}),e.jsxs("span",{children:["Posted: ",f(t.created_at)]})]})]})]}),e.jsxs(B,{className:"flex justify-between pt-2 border-t",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{size:"sm",variant:t.status==="open"?"default":"outline",onClick:()=>P(t.id,"open"),children:"Open"}),e.jsx(m,{size:"sm",variant:t.status==="resolved"?"default":"outline",onClick:()=>P(t.id,"resolved"),children:"Resolved"}),e.jsx(m,{size:"sm",variant:t.status==="closed"?"default":"outline",onClick:()=>P(t.id,"closed"),children:"Close"})]}),e.jsx(m,{size:"sm",variant:"destructive",onClick:()=>W(t.id),children:e.jsx(de,{className:"h-4 w-4"})})]})]},t.id)})})]}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Community Reports"}),V?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-pet-primary"})}):E.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:E.map(t=>{var s,r;return e.jsxs(S,{className:"overflow-hidden",children:[t.image_url&&e.jsx("div",{className:"aspect-video w-full overflow-hidden",children:e.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs(k,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(A,{className:"line-clamp-2",children:t.title}),e.jsx("div",{className:`px-2 py-1 text-xs rounded-full border ${R(t.status)}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx(I,{children:t.pet_type&&t.pet_breed?`${t.pet_type.charAt(0).toUpperCase()+t.pet_type.slice(1)} - ${t.pet_breed}`:((s=t.pet_type)==null?void 0:s.charAt(0).toUpperCase())+((r=t.pet_type)==null?void 0:r.slice(1))})]}),e.jsxs(O,{children:[e.jsx("p",{className:"text-sm line-clamp-3 mb-4",children:t.description}),e.jsxs("div",{className:"flex flex-col space-y-2 text-sm text-muted-foreground",children:[t.last_seen_location&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-3 w-3 mr-2"}),e.jsx("span",{children:t.last_seen_location})]}),t.last_seen_date&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:"h-3 w-3 mr-2"}),e.jsx("span",{children:f(t.last_seen_date)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:"h-3 w-3 mr-2"}),e.jsxs("span",{children:["Posted: ",f(t.created_at)]})]})]})]}),e.jsx(B,{className:"flex justify-between pt-2 border-t",children:e.jsxs("div",{className:"flex flex-col text-sm",children:[t.contact_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"h-3 w-3 mr-2"}),e.jsx("span",{children:t.contact_phone})]}),t.contact_email&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"h-3 w-3 mr-2"}),e.jsx("span",{children:t.contact_email})]})]})})]},t.id)})}):e.jsxs(S,{className:"p-10 text-center",children:[e.jsx("p",{children:"No lost and found reports found. Be the first to report!"}),e.jsx(m,{className:"mt-4",onClick:()=>x(!0),children:"Create Report"})]})]})};export{Le as default};
