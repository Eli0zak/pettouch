import{j as e}from"./ui-DskC_GZ4.js";import{r as g}from"./vendor-BlHcAAdO.js";import{N as T,y as P,K as z,B as y,L as D,Y as r,P as i,D as A,H as h,I as v,T as C}from"./index-fU-TRYU7.js";import{C as b,b as w,c as _,d as F,a as S,e as L}from"./card-BKNPTKQ9.js";import{T as O}from"./textarea-Dl2XRPf0.js";import{A as E}from"./arrow-left-Dxp14MfC.js";import{I as Y}from"./info-Dqd7-vNn.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";const J=()=>{const x=T(),{cartItems:n,subtotal:c,totalItems:p,clearCart:k}=P(),{toast:o}=z(),[s,q]=g.useState({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",country:"US",notes:""}),[j,f]=g.useState(!1),t=a=>{const{name:l,value:u}=a.target;q(m=>({...m,[l]:u}))},I=async a=>{if(a.preventDefault(),n.length===0){o({title:"Cart is empty",description:"Please add some items to your cart before checking out.",variant:"destructive"});return}try{f(!0);const l=n.map(d=>({product_id:d.product.id,quantity:d.quantity,price:Number((d.product.sale_price||d.product.price).toFixed(2)),product_name:d.product.name,selected_attributes:d.selected_attributes||{}})),u={name:`${s.firstName} ${s.lastName}`,street:s.address,street2:null,city:s.city,state:s.state,zip:s.zipCode,country:s.country,phone:s.phone,is_default:!1},{data:{user:m}}=await C.auth.getUser();if(!m){o({title:"Authentication required",description:"Please login to complete your purchase",variant:"destructive"}),x("/auth",{state:{returnUrl:"/checkout"}});return}const{error:N}=await C.from("store_orders").insert({user_id:m.id,items:l,shipping_address:u,total_amount:Number(c.toFixed(2)),subtotal:Number(c.toFixed(2)),shipping_fee:0,tax:0,discount:0,status:"pending",payment_info:{method:"credit_card",status:"pending",transaction_id:null,paid_at:null},customer_email:s.email,notes:s.notes||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(N)throw N;k(),o({title:"Order placed successfully",description:"Thank you for your purchase!"}),x("/dashboard/orders")}catch(l){console.error("Checkout error:",l),o({title:"Checkout failed",description:l.message||"There was an issue processing your order. Please try again.",variant:"destructive"})}finally{f(!1)}};return e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Checkout"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:e.jsx(y,{variant:"link",className:"p-0 h-auto",asChild:!0,children:e.jsxs(D,{to:"/store",className:"flex items-center",children:[e.jsx(E,{className:"mr-1 h-4 w-4"}),"Return to shopping"]})})})]}),e.jsxs("form",{onSubmit:I,children:[e.jsxs(b,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Your Information"}),e.jsx(F,{children:"Enter your details to complete your order"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"firstName",children:"First name *"}),e.jsx(i,{id:"firstName",name:"firstName",value:s.firstName,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"lastName",children:"Last name *"}),e.jsx(i,{id:"lastName",name:"lastName",value:s.lastName,onChange:t,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"email",children:"Email *"}),e.jsx(i,{id:"email",name:"email",type:"email",value:s.email,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"phone",children:"Phone"}),e.jsx(i,{id:"phone",name:"phone",value:s.phone,onChange:t})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"address",children:"Address *"}),e.jsx(i,{id:"address",name:"address",value:s.address,onChange:t,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(r,{htmlFor:"city",children:"City *"}),e.jsx(i,{id:"city",name:"city",value:s.city,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"state",children:"State *"}),e.jsx(i,{id:"state",name:"state",value:s.state,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"zipCode",children:"Zip Code *"}),e.jsx(i,{id:"zipCode",name:"zipCode",value:s.zipCode,onChange:t,required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"notes",children:"Order notes"}),e.jsx(O,{id:"notes",name:"notes",value:s.notes,onChange:t,placeholder:"Any special instructions for delivery",rows:3})]})]}),e.jsx(L,{children:e.jsxs("div",{className:"text-sm flex items-start gap-2",children:[e.jsx(Y,{className:"text-muted-foreground h-4 w-4 mt-0.5"}),e.jsx("span",{className:"text-muted-foreground",children:"Your personal data will be used to process your order and for other purposes described in our privacy policy."})]})})]}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx(y,{type:"submit",className:"w-full md:w-auto",disabled:j||n.length===0,children:j?"Processing...":"Place Order"})})]})]}),e.jsx("div",{className:"lg:w-80",children:e.jsxs(b,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center",children:[e.jsx(A,{className:"mr-2 h-5 w-5"})," Order Summary"]}),e.jsxs(F,{children:[p," item",p!==1&&"s"]})]}),e.jsxs(S,{children:[n.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your cart is empty"})}):e.jsx("div",{className:"space-y-4",children:n.map(a=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-16 w-16 overflow-hidden rounded-md border bg-muted flex-shrink-0",children:a.product.thumbnail?e.jsx("img",{src:a.product.thumbnail,alt:a.product.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-secondary text-secondary-foreground",children:e.jsx("span",{className:"text-xs",children:"No image"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.product.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",a.quantity]}),e.jsx("p",{className:"text-sm",children:h((a.product.sale_price||a.product.price)*a.quantity)})]})]},a.id))}),e.jsx(v,{className:"my-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:h(c)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Shipping"}),e.jsx("span",{className:"text-muted-foreground",children:"Calculated at checkout"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Tax"}),e.jsx("span",{className:"text-muted-foreground",children:"Calculated at checkout"})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total"}),e.jsx("span",{className:"font-bold",children:h(c)})]})]})]})]})})]})})};export{J as default};
