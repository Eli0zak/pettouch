import{j as i}from"./ui-DskC_GZ4.js";import{R,r as D}from"./vendor-BlHcAAdO.js";import{C as je,b as Te,c as De,a as Ie}from"./card-BKNPTKQ9.js";import{c as Pe,ac as Se,k as Le,V as I,T as q,a6 as O,a3 as Z,a5 as te,R as Oe,B as z}from"./index-fU-TRYU7.js";import{T as ke,a as Fe,b as se,c as V,d as Ue,e as X}from"./table-dY4MnRiV.js";import{D as ze,b as _e,c as Be,d as Qe,e as He,f as $e}from"./dialog-D6ZzA_3-.js";import{A as ne,a as re,b as ie,c as oe,d as ae,e as le,f as ce,g as de}from"./alert-dialog-Dv_zQmEg.js";import{Q as ue,C as Ge}from"./qr-code-C3h8dGEs.js";import{T as Ye}from"./trash-2-C636hku7.js";import{E as Ve}from"./external-link-DSkiF-5x.js";import{f as Xe}from"./format-cwXK75ha.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=Pe("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);var We=Object.defineProperty,K=Object.getOwnPropertySymbols,fe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable,he=(f,c,a)=>c in f?We(f,c,{enumerable:!0,configurable:!0,writable:!0,value:a}):f[c]=a,J=(f,c)=>{for(var a in c||(c={}))fe.call(c,a)&&he(f,a,c[a]);if(K)for(var a of K(c))ge.call(c,a)&&he(f,a,c[a]);return f},ee=(f,c)=>{var a={};for(var h in f)fe.call(f,h)&&c.indexOf(h)<0&&(a[h]=f[h]);if(f!=null&&K)for(var h of K(f))c.indexOf(h)<0&&ge.call(f,h)&&(a[h]=f[h]);return a};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var k;(f=>{const c=class E{constructor(e,s,t,n){if(this.version=e,this.errorCorrectionLevel=s,this.modules=[],this.isFunction=[],e<E.MIN_VERSION||e>E.MAX_VERSION)throw new RangeError("Version value out of range");if(n<-1||n>7)throw new RangeError("Mask value out of range");this.size=e*4+17;let r=[];for(let l=0;l<this.size;l++)r.push(!1);for(let l=0;l<this.size;l++)this.modules.push(r.slice()),this.isFunction.push(r.slice());this.drawFunctionPatterns();const d=this.addEccAndInterleave(t);if(this.drawCodewords(d),n==-1){let l=1e9;for(let p=0;p<8;p++){this.applyMask(p),this.drawFormatBits(p);const u=this.getPenaltyScore();u<l&&(n=p,l=u),this.applyMask(p)}}C(0<=n&&n<=7),this.mask=n,this.applyMask(n),this.drawFormatBits(n),this.isFunction=[]}static encodeText(e,s){const t=f.QrSegment.makeSegments(e);return E.encodeSegments(t,s)}static encodeBinary(e,s){const t=f.QrSegment.makeBytes(e);return E.encodeSegments([t],s)}static encodeSegments(e,s,t=1,n=40,r=-1,d=!0){if(!(E.MIN_VERSION<=t&&t<=n&&n<=E.MAX_VERSION)||r<-1||r>7)throw new RangeError("Invalid value");let l,p;for(l=t;;l++){const o=E.getNumDataCodewords(l,s)*8,x=v.getTotalBits(e,l);if(x<=o){p=x;break}if(l>=n)throw new RangeError("Data too long")}for(const o of[E.Ecc.MEDIUM,E.Ecc.QUARTILE,E.Ecc.HIGH])d&&p<=E.getNumDataCodewords(l,o)*8&&(s=o);let u=[];for(const o of e){a(o.mode.modeBits,4,u),a(o.numChars,o.mode.numCharCountBits(l),u);for(const x of o.getData())u.push(x)}C(u.length==p);const A=E.getNumDataCodewords(l,s)*8;C(u.length<=A),a(0,Math.min(4,A-u.length),u),a(0,(8-u.length%8)%8,u),C(u.length%8==0);for(let o=236;u.length<A;o^=253)a(o,8,u);let M=[];for(;M.length*8<u.length;)M.push(0);return u.forEach((o,x)=>M[x>>>3]|=o<<7-(x&7)),new E(l,s,M,r)}getModule(e,s){return 0<=e&&e<this.size&&0<=s&&s<this.size&&this.modules[s][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let t=0;t<this.size;t++)this.setFunctionModule(6,t,t%2==0),this.setFunctionModule(t,6,t%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),s=e.length;for(let t=0;t<s;t++)for(let n=0;n<s;n++)t==0&&n==0||t==0&&n==s-1||t==s-1&&n==0||this.drawAlignmentPattern(e[t],e[n]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const s=this.errorCorrectionLevel.formatBits<<3|e;let t=s;for(let r=0;r<10;r++)t=t<<1^(t>>>9)*1335;const n=(s<<10|t)^21522;C(n>>>15==0);for(let r=0;r<=5;r++)this.setFunctionModule(8,r,h(n,r));this.setFunctionModule(8,7,h(n,6)),this.setFunctionModule(8,8,h(n,7)),this.setFunctionModule(7,8,h(n,8));for(let r=9;r<15;r++)this.setFunctionModule(14-r,8,h(n,r));for(let r=0;r<8;r++)this.setFunctionModule(this.size-1-r,8,h(n,r));for(let r=8;r<15;r++)this.setFunctionModule(8,this.size-15+r,h(n,r));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let t=0;t<12;t++)e=e<<1^(e>>>11)*7973;const s=this.version<<12|e;C(s>>>18==0);for(let t=0;t<18;t++){const n=h(s,t),r=this.size-11+t%3,d=Math.floor(t/3);this.setFunctionModule(r,d,n),this.setFunctionModule(d,r,n)}}drawFinderPattern(e,s){for(let t=-4;t<=4;t++)for(let n=-4;n<=4;n++){const r=Math.max(Math.abs(n),Math.abs(t)),d=e+n,l=s+t;0<=d&&d<this.size&&0<=l&&l<this.size&&this.setFunctionModule(d,l,r!=2&&r!=4)}}drawAlignmentPattern(e,s){for(let t=-2;t<=2;t++)for(let n=-2;n<=2;n++)this.setFunctionModule(e+n,s+t,Math.max(Math.abs(n),Math.abs(t))!=1)}setFunctionModule(e,s,t){this.modules[s][e]=t,this.isFunction[s][e]=!0}addEccAndInterleave(e){const s=this.version,t=this.errorCorrectionLevel;if(e.length!=E.getNumDataCodewords(s,t))throw new RangeError("Invalid argument");const n=E.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][s],r=E.ECC_CODEWORDS_PER_BLOCK[t.ordinal][s],d=Math.floor(E.getNumRawDataModules(s)/8),l=n-d%n,p=Math.floor(d/n);let u=[];const A=E.reedSolomonComputeDivisor(r);for(let o=0,x=0;o<n;o++){let j=e.slice(x,x+p-r+(o<l?0:1));x+=j.length;const F=E.reedSolomonComputeRemainder(j,A);o<l&&j.push(0),u.push(j.concat(F))}let M=[];for(let o=0;o<u[0].length;o++)u.forEach((x,j)=>{(o!=p-r||j>=l)&&M.push(x[o])});return C(M.length==d),M}drawCodewords(e){if(e.length!=Math.floor(E.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let s=0;for(let t=this.size-1;t>=1;t-=2){t==6&&(t=5);for(let n=0;n<this.size;n++)for(let r=0;r<2;r++){const d=t-r,p=(t+1&2)==0?this.size-1-n:n;!this.isFunction[p][d]&&s<e.length*8&&(this.modules[p][d]=h(e[s>>>3],7-(s&7)),s++)}}C(s==e.length*8)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let s=0;s<this.size;s++)for(let t=0;t<this.size;t++){let n;switch(e){case 0:n=(t+s)%2==0;break;case 1:n=s%2==0;break;case 2:n=t%3==0;break;case 3:n=(t+s)%3==0;break;case 4:n=(Math.floor(t/3)+Math.floor(s/2))%2==0;break;case 5:n=t*s%2+t*s%3==0;break;case 6:n=(t*s%2+t*s%3)%2==0;break;case 7:n=((t+s)%2+t*s%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[s][t]&&n&&(this.modules[s][t]=!this.modules[s][t])}}getPenaltyScore(){let e=0;for(let r=0;r<this.size;r++){let d=!1,l=0,p=[0,0,0,0,0,0,0];for(let u=0;u<this.size;u++)this.modules[r][u]==d?(l++,l==5?e+=E.PENALTY_N1:l>5&&e++):(this.finderPenaltyAddHistory(l,p),d||(e+=this.finderPenaltyCountPatterns(p)*E.PENALTY_N3),d=this.modules[r][u],l=1);e+=this.finderPenaltyTerminateAndCount(d,l,p)*E.PENALTY_N3}for(let r=0;r<this.size;r++){let d=!1,l=0,p=[0,0,0,0,0,0,0];for(let u=0;u<this.size;u++)this.modules[u][r]==d?(l++,l==5?e+=E.PENALTY_N1:l>5&&e++):(this.finderPenaltyAddHistory(l,p),d||(e+=this.finderPenaltyCountPatterns(p)*E.PENALTY_N3),d=this.modules[u][r],l=1);e+=this.finderPenaltyTerminateAndCount(d,l,p)*E.PENALTY_N3}for(let r=0;r<this.size-1;r++)for(let d=0;d<this.size-1;d++){const l=this.modules[r][d];l==this.modules[r][d+1]&&l==this.modules[r+1][d]&&l==this.modules[r+1][d+1]&&(e+=E.PENALTY_N2)}let s=0;for(const r of this.modules)s=r.reduce((d,l)=>d+(l?1:0),s);const t=this.size*this.size,n=Math.ceil(Math.abs(s*20-t*10)/t)-1;return C(0<=n&&n<=9),e+=n*E.PENALTY_N4,C(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(this.version==1)return[];{const e=Math.floor(this.version/7)+2,s=this.version==32?26:Math.ceil((this.version*4+4)/(e*2-2))*2;let t=[6];for(let n=this.size-7;t.length<e;n-=s)t.splice(1,0,n);return t}}static getNumRawDataModules(e){if(e<E.MIN_VERSION||e>E.MAX_VERSION)throw new RangeError("Version number out of range");let s=(16*e+128)*e+64;if(e>=2){const t=Math.floor(e/7)+2;s-=(25*t-10)*t-55,e>=7&&(s-=36)}return C(208<=s&&s<=29648),s}static getNumDataCodewords(e,s){return Math.floor(E.getNumRawDataModules(e)/8)-E.ECC_CODEWORDS_PER_BLOCK[s.ordinal][e]*E.NUM_ERROR_CORRECTION_BLOCKS[s.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let s=[];for(let n=0;n<e-1;n++)s.push(0);s.push(1);let t=1;for(let n=0;n<e;n++){for(let r=0;r<s.length;r++)s[r]=E.reedSolomonMultiply(s[r],t),r+1<s.length&&(s[r]^=s[r+1]);t=E.reedSolomonMultiply(t,2)}return s}static reedSolomonComputeRemainder(e,s){let t=s.map(n=>0);for(const n of e){const r=n^t.shift();t.push(0),s.forEach((d,l)=>t[l]^=E.reedSolomonMultiply(d,r))}return t}static reedSolomonMultiply(e,s){if(e>>>8||s>>>8)throw new RangeError("Byte out of range");let t=0;for(let n=7;n>=0;n--)t=t<<1^(t>>>7)*285,t^=(s>>>n&1)*e;return C(t>>>8==0),t}finderPenaltyCountPatterns(e){const s=e[1];C(s<=this.size*3);const t=s>0&&e[2]==s&&e[3]==s*3&&e[4]==s&&e[5]==s;return(t&&e[0]>=s*4&&e[6]>=s?1:0)+(t&&e[6]>=s*4&&e[0]>=s?1:0)}finderPenaltyTerminateAndCount(e,s,t){return e&&(this.finderPenaltyAddHistory(s,t),s=0),s+=this.size,this.finderPenaltyAddHistory(s,t),this.finderPenaltyCountPatterns(t)}finderPenaltyAddHistory(e,s){s[0]==0&&(e+=this.size),s.pop(),s.unshift(e)}};c.MIN_VERSION=1,c.MAX_VERSION=40,c.PENALTY_N1=3,c.PENALTY_N2=3,c.PENALTY_N3=40,c.PENALTY_N4=10,c.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],c.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],f.QrCode=c;function a(w,e,s){if(e<0||e>31||w>>>e)throw new RangeError("Value out of range");for(let t=e-1;t>=0;t--)s.push(w>>>t&1)}function h(w,e){return(w>>>e&1)!=0}function C(w){if(!w)throw new Error("Assertion error")}const g=class y{constructor(e,s,t){if(this.mode=e,this.numChars=s,this.bitData=t,s<0)throw new RangeError("Invalid argument");this.bitData=t.slice()}static makeBytes(e){let s=[];for(const t of e)a(t,8,s);return new y(y.Mode.BYTE,e.length,s)}static makeNumeric(e){if(!y.isNumeric(e))throw new RangeError("String contains non-numeric characters");let s=[];for(let t=0;t<e.length;){const n=Math.min(e.length-t,3);a(parseInt(e.substring(t,t+n),10),n*3+1,s),t+=n}return new y(y.Mode.NUMERIC,e.length,s)}static makeAlphanumeric(e){if(!y.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");let s=[],t;for(t=0;t+2<=e.length;t+=2){let n=y.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t))*45;n+=y.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t+1)),a(n,11,s)}return t<e.length&&a(y.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t)),6,s),new y(y.Mode.ALPHANUMERIC,e.length,s)}static makeSegments(e){return e==""?[]:y.isNumeric(e)?[y.makeNumeric(e)]:y.isAlphanumeric(e)?[y.makeAlphanumeric(e)]:[y.makeBytes(y.toUtf8ByteArray(e))]}static makeEci(e){let s=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)a(e,8,s);else if(e<16384)a(2,2,s),a(e,14,s);else if(e<1e6)a(6,3,s),a(e,21,s);else throw new RangeError("ECI assignment value out of range");return new y(y.Mode.ECI,0,s)}static isNumeric(e){return y.NUMERIC_REGEX.test(e)}static isAlphanumeric(e){return y.ALPHANUMERIC_REGEX.test(e)}getData(){return this.bitData.slice()}static getTotalBits(e,s){let t=0;for(const n of e){const r=n.mode.numCharCountBits(s);if(n.numChars>=1<<r)return 1/0;t+=4+r+n.bitData.length}return t}static toUtf8ByteArray(e){e=encodeURI(e);let s=[];for(let t=0;t<e.length;t++)e.charAt(t)!="%"?s.push(e.charCodeAt(t)):(s.push(parseInt(e.substring(t+1,t+3),16)),t+=2);return s}};g.NUMERIC_REGEX=/^[0-9]*$/,g.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,g.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let v=g;f.QrSegment=g})(k||(k={}));(f=>{(c=>{const a=class{constructor(C,g){this.ordinal=C,this.formatBits=g}};a.LOW=new a(0,1),a.MEDIUM=new a(1,0),a.QUARTILE=new a(2,3),a.HIGH=new a(3,2),c.Ecc=a})(f.QrCode||(f.QrCode={}))})(k||(k={}));(f=>{(c=>{const a=class{constructor(C,g){this.modeBits=C,this.numBitsCharCount=g}numCharCountBits(C){return this.numBitsCharCount[Math.floor((C+7)/17)]}};a.NUMERIC=new a(1,[10,12,14]),a.ALPHANUMERIC=new a(2,[9,11,13]),a.BYTE=new a(4,[8,16,16]),a.KANJI=new a(8,[8,10,12]),a.ECI=new a(7,[0,0,0]),c.Mode=a})(f.QrSegment||(f.QrSegment={}))})(k||(k={}));var _=k;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var qe={L:_.QrCode.Ecc.LOW,M:_.QrCode.Ecc.MEDIUM,Q:_.QrCode.Ecc.QUARTILE,H:_.QrCode.Ecc.HIGH},me=128,pe="L",Ee="#FFFFFF",Ce="#000000",we=!1,xe=1,Ze=4,Je=0,et=.1;function Me(f,c=0){const a=[];return f.forEach(function(h,C){let g=null;h.forEach(function(v,w){if(!v&&g!==null){a.push(`M${g+c} ${C+c}h${w-g}v1H${g+c}z`),g=null;return}if(w===h.length-1){if(!v)return;g===null?a.push(`M${w+c},${C+c} h1v1H${w+c}z`):a.push(`M${g+c},${C+c} h${w+1-g}v1H${g+c}z`);return}v&&g===null&&(g=w)})}),a.join("")}function ye(f,c){return f.slice().map((a,h)=>h<c.y||h>=c.y+c.h?a:a.map((C,g)=>g<c.x||g>=c.x+c.w?C:!1))}function tt(f,c,a,h){if(h==null)return null;const C=f.length+a*2,g=Math.floor(c*et),v=C/c,w=(h.width||g)*v,e=(h.height||g)*v,s=h.x==null?f.length/2-w/2:h.x*v,t=h.y==null?f.length/2-e/2:h.y*v,n=h.opacity==null?1:h.opacity;let r=null;if(h.excavate){let l=Math.floor(s),p=Math.floor(t),u=Math.ceil(w+s-l),A=Math.ceil(e+t-p);r={x:l,y:p,w:u,h:A}}const d=h.crossOrigin;return{x:s,y:t,h:e,w,excavation:r,opacity:n,crossOrigin:d}}function st(f,c){return c!=null?Math.max(Math.floor(c),0):f?Ze:Je}function ve({value:f,level:c,minVersion:a,includeMargin:h,marginSize:C,imageSettings:g,size:v,boostLevel:w}){let e=R.useMemo(()=>{const l=(Array.isArray(f)?f:[f]).reduce((p,u)=>(p.push(..._.QrSegment.makeSegments(u)),p),[]);return _.QrCode.encodeSegments(l,qe[c],a,void 0,void 0,w)},[f,c,a,w]);const{cells:s,margin:t,numCells:n,calculatedImageSettings:r}=R.useMemo(()=>{let d=e.getModules();const l=st(h,C),p=d.length+l*2,u=tt(d,v,l,g);return{cells:d,margin:l,numCells:p,calculatedImageSettings:u}},[e,v,g,h,C]);return{qrcode:e,margin:t,cells:s,numCells:n,calculatedImageSettings:r}}var nt=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),rt=R.forwardRef(function(c,a){const h=c,{value:C,size:g=me,level:v=pe,bgColor:w=Ee,fgColor:e=Ce,includeMargin:s=we,minVersion:t=xe,boostLevel:n,marginSize:r,imageSettings:d}=h,p=ee(h,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:u}=p,A=ee(p,["style"]),M=d==null?void 0:d.src,o=R.useRef(null),x=R.useRef(null),j=R.useCallback(N=>{o.current=N,typeof a=="function"?a(N):a&&(a.current=N)},[a]),[F,$]=R.useState(!1),{margin:P,cells:B,numCells:Q,calculatedImageSettings:T}=ve({value:C,level:v,minVersion:t,boostLevel:n,includeMargin:s,marginSize:r,imageSettings:d,size:g});R.useEffect(()=>{if(o.current!=null){const N=o.current,b=N.getContext("2d");if(!b)return;let G=B;const S=x.current,H=T!=null&&S!==null&&S.complete&&S.naturalHeight!==0&&S.naturalWidth!==0;H&&T.excavation!=null&&(G=ye(B,T.excavation));const U=window.devicePixelRatio||1;N.height=N.width=g*U;const Y=g/Q*U;b.scale(Y,Y),b.fillStyle=w,b.fillRect(0,0,Q,Q),b.fillStyle=e,nt?b.fill(new Path2D(Me(G,P))):B.forEach(function(L,Re){L.forEach(function(Ae,be){Ae&&b.fillRect(be+P,Re+P,1,1)})}),T&&(b.globalAlpha=T.opacity),H&&b.drawImage(S,T.x+P,T.y+P,T.w,T.h)}}),R.useEffect(()=>{$(!1)},[M]);const W=J({height:g,width:g},u);let m=null;return M!=null&&(m=R.createElement("img",{src:M,key:M,style:{display:"none"},onLoad:()=>{$(!0)},ref:x,crossOrigin:T==null?void 0:T.crossOrigin})),R.createElement(R.Fragment,null,R.createElement("canvas",J({style:W,height:g,width:g,ref:j,role:"img"},A)),m)});rt.displayName="QRCodeCanvas";var Ne=R.forwardRef(function(c,a){const h=c,{value:C,size:g=me,level:v=pe,bgColor:w=Ee,fgColor:e=Ce,includeMargin:s=we,minVersion:t=xe,boostLevel:n,title:r,marginSize:d,imageSettings:l}=h,p=ee(h,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:u,cells:A,numCells:M,calculatedImageSettings:o}=ve({value:C,level:v,minVersion:t,boostLevel:n,includeMargin:s,marginSize:d,imageSettings:l,size:g});let x=A,j=null;l!=null&&o!=null&&(o.excavation!=null&&(x=ye(A,o.excavation)),j=R.createElement("image",{href:l.src,height:o.h,width:o.w,x:o.x+u,y:o.y+u,preserveAspectRatio:"none",opacity:o.opacity,crossOrigin:o.crossOrigin}));const F=Me(x,u);return R.createElement("svg",J({height:g,width:g,viewBox:`0 0 ${M} ${M}`,ref:a,role:"img"},p),!!r&&R.createElement("title",null,r),R.createElement("path",{fill:w,d:`M0,0 h${M}v${M}H0z`,shapeRendering:"crispEdges"}),R.createElement("path",{fill:e,d:F,shapeRendering:"crispEdges"}),j)});Ne.displayName="QRCodeSVG";const xt=()=>{const[f,c]=D.useState([]),[a,h]=D.useState(!0),[C,g]=D.useState(!1),[v,w]=D.useState(!1),[e,s]=D.useState(!1),[t,n]=D.useState(null),[r,d]=D.useState(!1),[l,p]=D.useState(""),{userId:u,isAuthenticated:A,loading:M}=Se(),{t:o}=Le();D.useEffect(()=>{if(M){I.info("Auth is still loading");return}if(!A){I.info("User is not authenticated");return}I.info("ManageTags mounted",{userId:u}),x()},[u,A,M]);const x=async()=>{I.info("Fetching tags for user",{userId:u}),h(!0);try{if(!u){I.warn("No userId available");return}const{data:m,error:N}=await q.from("nfc_tags").select(`
          id,
          tag_code,
          pet_id,
          user_id,
          status,
          created_at,
          updated_at,
          pet:pets(id, name)
        `).eq("user_id",u).order("created_at",{ascending:!1});if(N)throw I.error("Error fetching tags",{error:N,userId:u}),N;I.info("Tags fetched",{data:m,count:(m==null?void 0:m.length)||0,userId:u}),c(m||[])}catch(m){I.error("Error fetching tags",{error:m,userId:u}),O({title:o("error"),description:m.message||o("Failed to fetch tags"),variant:"destructive"})}finally{h(!1)}},j=async()=>{if(t){d(!0);try{const{error:m}=await q.from("nfc_tags").update({pet_id:null,status:"unassigned",updated_at:new Date().toISOString()}).eq("id",t.id);if(m)throw m;O({title:o("success"),description:o("Tag unlinked successfully")}),w(!1),x()}catch(m){O({title:o("error"),description:m.message||o("Failed to unlink tag"),variant:"destructive"})}finally{d(!1)}}},F=async()=>{if(t){d(!0);try{const{error:m}=await q.from("nfc_tags").delete().eq("id",t.id);if(m)throw m;O({title:o("success"),description:o("Tag deleted successfully")}),s(!1),x()}catch(m){O({title:o("error"),description:m.message||o("Failed to delete tag"),variant:"destructive"})}finally{d(!1)}}},$=m=>{n(m);const b=`${window.location.origin}/tag/${m.tag_code}`;p(b),g(!0)},P=m=>{n(m),w(!0)},B=m=>{n(m),s(!0)},Q=()=>{l&&(navigator.clipboard.writeText(l),O({title:o("success"),description:o("Link copied to clipboard")}))},T=()=>{if(!t)return;const m=document.getElementById("tag-qr-code");if(m)try{const N=document.createElement("canvas"),b=N.getContext("2d");if(N.width=200,N.height=200,b){const G=new XMLSerializer().serializeToString(m),S=new Blob([G],{type:"image/svg+xml;charset=utf-8"}),H=URL.createObjectURL(S),U=new Image;U.onload=()=>{b.drawImage(U,0,0);const Y=N.toDataURL("image/png"),L=document.createElement("a");L.href=Y,L.download=`tag-${t.tag_code}.png`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(H)},U.src=H}}catch(N){console.error("Error downloading QR code:",N),O({title:o("error"),description:o("Failed to download QR code"),variant:"destructive"})}},W=m=>Xe(new Date(m),"MMM d, yyyy");return M||a?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx(Z,{size:"lg",text:o("Loading...")})}):A?i.jsxs("div",{className:"container mx-auto py-8 px-4",children:[i.jsx("div",{className:"flex flex-col gap-6",children:i.jsxs(je,{children:[i.jsx(Te,{children:i.jsx(De,{children:o("nfcTags.title")})}),i.jsx(Ie,{children:f.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx(te,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium mb-2",children:o("nfcTags.empty.title")}),i.jsx("p",{className:"text-muted-foreground",children:o("nfcTags.empty.description")})]}):i.jsxs(ke,{children:[i.jsx(Fe,{children:i.jsxs(se,{children:[i.jsx(V,{children:o("nfcTags.tagCode")}),i.jsx(V,{children:o("nfcTags.linkedPet")}),i.jsx(V,{children:o("nfcTags.addedOn")}),i.jsx(V,{className:"text-right",children:o("nfcTags.actions")})]})}),i.jsx(Ue,{children:f.map(m=>i.jsxs(se,{children:[i.jsx(X,{children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),m.tag_code]})}),i.jsx(X,{children:m.pet?i.jsx(Oe,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:m.pet.name}):i.jsx("span",{className:"text-muted-foreground",children:o("nfcTags.notLinked")})}),i.jsx(X,{children:W(m.created_at)}),i.jsx(X,{className:"text-right",children:i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx(z,{variant:"outline",size:"sm",onClick:()=>$(m),children:i.jsx(ue,{className:"h-4 w-4"})}),m.pet_id&&i.jsx(z,{variant:"outline",size:"sm",onClick:()=>P(m),children:i.jsx(Ke,{className:"h-4 w-4"})}),i.jsx(z,{variant:"outline",size:"sm",onClick:()=>B(m),children:i.jsx(Ye,{className:"h-4 w-4"})})]})})]},m.id))})]})})]})}),i.jsx(ze,{open:C,onOpenChange:g,children:i.jsxs(_e,{children:[i.jsxs(Be,{children:[i.jsx(Qe,{children:o("nfcTags.qrDialog.title")}),i.jsx(He,{children:o("nfcTags.qrDialog.description")})]}),i.jsxs("div",{className:"flex flex-col items-center space-y-4 py-4",children:[i.jsx("div",{className:"bg-white p-4 rounded-lg",children:i.jsx(Ne,{id:"tag-qr-code",value:l,size:200,level:"H",includeMargin:!0})}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"font-medium",children:t==null?void 0:t.tag_code}),i.jsx("p",{className:"text-sm text-muted-foreground break-all",children:l})]})]}),i.jsxs($e,{className:"flex flex-col sm:flex-row gap-2",children:[i.jsxs(z,{variant:"outline",className:"w-full sm:w-auto",onClick:Q,children:[i.jsx(Ge,{className:"mr-2 h-4 w-4"})," ",o("nfcTags.copyLink")]}),i.jsxs(z,{variant:"outline",className:"w-full sm:w-auto",onClick:T,children:[i.jsx(ue,{className:"mr-2 h-4 w-4"})," ",o("nfcTags.downloadQR")]}),i.jsx(z,{className:"w-full sm:w-auto",asChild:!0,children:i.jsxs("a",{href:l,target:"_blank",rel:"noopener noreferrer",children:[i.jsx(Ve,{className:"mr-2 h-4 w-4"})," ",o("nfcTags.openLink")]})})]})]})}),i.jsx(ne,{open:v,onOpenChange:w,children:i.jsxs(re,{children:[i.jsxs(ie,{children:[i.jsx(oe,{children:o("nfcTags.unlinkDialog.title")}),i.jsx(ae,{children:o("nfcTags.unlinkDialog.description")})]}),i.jsxs(le,{children:[i.jsx(ce,{children:o("button.cancel")}),i.jsxs(de,{onClick:j,disabled:r,children:[r?i.jsx(Z,{size:"sm",className:"mr-2"}):null,o("button.unlink")]})]})]})}),i.jsx(ne,{open:e,onOpenChange:s,children:i.jsxs(re,{children:[i.jsxs(ie,{children:[i.jsx(oe,{children:o("nfcTags.deleteDialog.title")}),i.jsx(ae,{children:o("nfcTags.deleteDialog.description")})]}),i.jsxs(le,{children:[i.jsx(ce,{children:o("button.cancel")}),i.jsxs(de,{onClick:F,disabled:r,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[r?i.jsx(Z,{size:"sm",className:"mr-2"}):null,o("button.delete")]})]})]})})]}):i.jsx("div",{className:"container mx-auto py-8 px-4",children:i.jsx("div",{className:"flex flex-col items-center justify-center h-64",children:i.jsx("p",{className:"text-lg text-muted-foreground",children:"Please sign in to view your NFC tags."})})})};export{xt as default};
