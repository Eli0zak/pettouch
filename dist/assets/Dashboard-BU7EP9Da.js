import{j as e}from"./ui-DskC_GZ4.js";import{r as N}from"./vendor-BlHcAAdO.js";import{c as F,$,a0 as z,a1 as G,a2 as T,N as M,T as i,V as m,_ as D,a3 as V,B as b,a4 as B,L as _}from"./index-fU-TRYU7.js";import{C as c,b as l,c as o,a as j,e as d,d as L}from"./card-BKNPTKQ9.js";import{L as H}from"./layers-DTNwDXJk.js";import{C as O}from"./clock-BvbAatTJ.js";import{C as I}from"./circle-alert-BLBRoTNw.js";import{A as Q}from"./arrow-up-right-DVmJcFtH.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=F("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);function W({src:s,fallback:h="U",className:y,size:w="md"}){const r={sm:"h-8 w-8",md:"h-10 w-10",lg:"h-16 w-16"};return e.jsxs($,{className:`${r[w]} ${y||""}`,children:[e.jsx(z,{src:s||void 0,alt:"Avatar",onError:v=>{const x=v.target;x.style.display="none"}}),e.jsx(G,{className:"bg-muted text-muted-foreground",children:h?h.charAt(0).toUpperCase():e.jsx(T,{className:"h-4 w-4"})})]})}const ce=()=>{var U,k;const[s,h]=N.useState(null),[y,w]=N.useState(!0),[r,v]=N.useState({totalPets:0,recentScans:0,currentPlan:"Free",petLimit:1}),x=M(),C=async a=>{try{const{count:p,error:g}=await i.from("pets").select("*",{count:"exact",head:!0}).eq("owner_id",a);if(g){m.error("Error fetching pet count",{error:g,userId:a});return}const t=new Date;t.setDate(t.getDate()-30);const{count:n,error:E}=await i.from("nfc_scans").select("*",{count:"exact",head:!0}).eq("user_id",a).gte("created_at",t.toISOString());E&&m.error("Error fetching scans count",{error:E,userId:a});const{data:A,error:S}=await i.from("users").select("plan").eq("id",a).single();if(S){m.error("Error fetching user plan",{error:S,userId:a});return}const f=(A==null?void 0:A.plan)||"free";let P=1;f==="comfort"?P=3:f==="rescue"&&(P=999);const q=f.charAt(0).toUpperCase()+f.slice(1);v({totalPets:p||0,recentScans:n||0,currentPlan:q,petLimit:P})}catch(p){m.error("Error fetching dashboard data",{error:p,userId:a})}};N.useEffect(()=>{(async()=>{try{const{data:t}=await i.auth.getUser();t!=null&&t.user&&(h(t.user),await C(t.user.id))}catch(t){m.error("Error fetching user data",{error:t})}finally{w(!1)}})();const p=i.auth.onAuthStateChange(async(t,n)=>{t==="SIGNED_IN"&&(n!=null&&n.user)?(h(n.user),await C(n.user.id)):t==="SIGNED_OUT"&&x("/auth")}),g=i.channel("user-plan-dashboard").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users",filter:s?`id=eq.${s.id}`:void 0},async t=>{m.info("User data changed in dashboard",{payload:t.new,userId:s==null?void 0:s.id}),t.new&&s&&await C(s.id)}).subscribe();return()=>{p.data.subscription.unsubscribe(),i.removeChannel(g)}},[x,s==null?void 0:s.id]);const u=a=>{x(a)};return y?e.jsx(D,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(V,{size:"lg",text:"Loading dashboard..."})})}):e.jsx(D,{children:e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(W,{size:"lg",fallback:((U=s==null?void 0:s.email)==null?void 0:U.charAt(0))||"U"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Welcome back, ",(k=s==null?void 0:s.email)==null?void 0:k.split("@")[0]]}),e.jsx("p",{className:"text-gray-600",children:"Here's an overview of your PetTouch account"})]})]}),e.jsxs(b,{className:"mt-4 md:mt-0 bg-pet-primary hover:bg-pet-secondary",onClick:()=>u("/dashboard/pets"),children:[e.jsx(R,{className:"mr-2 h-4 w-4"})," Add New Pet"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(c,{className:"hover:shadow-md transition-shadow",children:[e.jsx(l,{className:"pb-2",children:e.jsx(o,{className:"text-lg font-medium text-gray-700",children:"Total Pets"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-3xl font-bold",children:r.totalPets}),e.jsx(H,{className:"h-8 w-8 text-pet-primary"})]})}),e.jsx(d,{className:"pt-0 text-sm text-gray-500",children:e.jsxs("span",{children:["Limit: ",r.totalPets,"/",r.petLimit===999?"âˆž":r.petLimit," pets"]})})]}),e.jsxs(c,{className:"hover:shadow-md transition-shadow",children:[e.jsx(l,{className:"pb-2",children:e.jsx(o,{className:"text-lg font-medium text-gray-700",children:"Recent Scans"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-3xl font-bold",children:r.recentScans}),e.jsx(O,{className:"h-8 w-8 text-pet-primary"})]})}),e.jsx(d,{className:"pt-0 text-sm text-gray-500",children:e.jsx("span",{children:"Last 30 days"})})]}),e.jsxs(c,{className:"hover:shadow-md transition-shadow",children:[e.jsx(l,{className:"pb-2",children:e.jsx(o,{className:"text-lg font-medium text-gray-700",children:"Current Plan"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-3xl font-bold",children:r.currentPlan}),e.jsx(B,{className:"h-8 w-8 text-pet-primary"})]})}),e.jsx(d,{className:"pt-0 text-sm text-gray-500",children:e.jsx(_,{to:"/dashboard/subscription",className:"text-pet-primary hover:underline",children:"Upgrade"})})]}),e.jsxs(c,{className:"hover:shadow-md transition-shadow",children:[e.jsx(l,{className:"pb-2",children:e.jsx(o,{className:"text-lg font-medium text-gray-700",children:"Account"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg truncate max-w-[150px]",children:s==null?void 0:s.email}),e.jsx(T,{className:"h-8 w-8 text-pet-primary"})]})}),e.jsx(d,{className:"pt-0 text-sm text-gray-500",children:e.jsx(_,{to:"/dashboard/settings",className:"text-pet-primary hover:underline",children:"Manage"})})]})]}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(c,{className:"bg-gradient-to-br from-pet-accent1/20 to-pet-accent2/10 hover:shadow-md transition-shadow duration-200",children:[e.jsxs(l,{children:[e.jsxs(o,{className:"flex items-center",children:[e.jsx(R,{className:"mr-2 h-5 w-5 text-pet-primary"}),"Register New Pet"]}),e.jsx(L,{children:"Add a new pet to your account"})]}),e.jsx(d,{children:e.jsx(b,{variant:"outline",className:"w-full border-pet-primary text-pet-primary hover:bg-pet-accent1/20",onClick:()=>u("/dashboard/pets"),children:"Add Pet"})})]}),e.jsxs(c,{className:"bg-gradient-to-br from-pet-accent2/20 to-pet-accent1/10 hover:shadow-md transition-shadow duration-200",children:[e.jsxs(l,{children:[e.jsxs(o,{className:"flex items-center",children:[e.jsx(I,{className:"mr-2 h-5 w-5 text-pet-primary"}),"Lost & Found"]}),e.jsx(L,{children:"Check community reports"})]}),e.jsx(d,{children:e.jsx(b,{variant:"outline",className:"w-full border-pet-primary text-pet-primary hover:bg-pet-accent1/20",onClick:()=>u("/dashboard/lost-found"),children:"View Reports"})})]}),e.jsxs(c,{className:"bg-gradient-to-br from-pet-accent1/10 to-pet-accent2/20 hover:shadow-md transition-shadow duration-200",children:[e.jsxs(l,{children:[e.jsxs(o,{className:"flex items-center",children:[e.jsx(Q,{className:"mr-2 h-5 w-5 text-pet-primary"}),"Upgrade Plan"]}),e.jsx(L,{children:"Get more features and benefits"})]}),e.jsx(d,{children:e.jsx(b,{className:"w-full bg-pet-primary hover:bg-pet-secondary text-white",onClick:()=>u("/dashboard/subscription"),children:"View Plans"})})]})]}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Recent Activity"}),e.jsx(c,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No recent activity to display."}),e.jsx("p",{className:"mt-2",children:"Register your first pet to start tracking activities."})]})})})]})})};export{ce as default};
