import{j as e}from"./ui-DskC_GZ4.js";import{r as o}from"./vendor-BlHcAAdO.js";import{c as M,N as R,k as Q,K as V,T as g,O as z,P as Y,B as x,Q as v,aa as K,R as c,ab as U}from"./index-fU-TRYU7.js";import{C as S,a as T,c as O,b as G}from"./card-BKNPTKQ9.js";import{T as J,a as W,b as h,c as X}from"./tabs-DPPu6Y5N.js";import{D as Z,a as ee,b as se,c as re,d as te}from"./dialog-D6ZzA_3-.js";import{T as D,a as F,b as f,c as i,d as L,e as d}from"./table-dY4MnRiV.js";import{L as ae}from"./loader-circle-Cj1b-iFM.js";import{E as ne}from"./external-link-DSkiF-5x.js";import{C as le}from"./circle-alert-BLBRoTNw.js";import{C as ie}from"./circle-check-big-C5mTEYhf.js";import{f as de}from"./format-cwXK75ha.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=M("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]),_e=()=>{const m=R(),{t:s}=Q(),{toast:b}=V(),[$,q]=o.useState([]),[H,y]=o.useState(!0),[r,B]=o.useState(null),[p,E]=o.useState(""),[u,I]=o.useState("all");o.useEffect(()=>{const t=async()=>{try{y(!0);const{data:{user:n}}=await g.auth.getUser();if(!n){m("/auth");return}const{data:a,error:j}=await g.from("store_orders").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});if(j)throw j;q(a)}catch(n){console.error("Error fetching orders:",n),b({title:"Error",description:"Failed to load your orders",variant:"destructive"})}finally{y(!1)}};t();const l=g.channel("orders-channel").on("postgres_changes",{event:"*",schema:"public",table:"store_orders"},n=>{console.log("Order update:",n),t()}).subscribe();return()=>{g.removeChannel(l)}},[m,b]);const P=()=>{let t=$;if(u!=="all"&&(t=t.filter(l=>l.status===u)),p){const l=p.toLowerCase();t=t.filter(n=>{var a;return n.id.toLowerCase().includes(l)||((a=n.tracking_number)==null?void 0:a.toLowerCase().includes(l))||n.status.toLowerCase().includes(l)})}return t},w=t=>{switch(t){case"pending":return e.jsx(c,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:s("store.orderStatus.pending")});case"processing":return e.jsx(c,{variant:"outline",className:"bg-blue-100 text-blue-800",children:s("store.orderStatus.processing")});case"shipped":return e.jsx(c,{variant:"outline",className:"bg-purple-100 text-purple-800",children:s("store.orderStatus.shipped")});case"delivered":return e.jsx(c,{variant:"outline",className:"bg-green-100 text-green-800",children:s("store.orderStatus.delivered")});case"cancelled":return e.jsx(c,{variant:"outline",className:"bg-red-100 text-red-800",children:s("store.orderStatus.cancelled")});case"refunded":return e.jsx(c,{variant:"outline",className:"bg-gray-100 text-gray-800",children:s("store.orderStatus.refunded")});default:return e.jsx(c,{variant:"outline",children:t})}},_=t=>{switch(t){case"pending":return e.jsx(v,{className:"h-5 w-5 text-yellow-500"});case"processing":return e.jsx(U,{className:"h-5 w-5 text-blue-500"});case"shipped":return e.jsx(ce,{className:"h-5 w-5 text-purple-500"});case"delivered":return e.jsx(ie,{className:"h-5 w-5 text-green-500"});case"cancelled":case"refunded":return e.jsx(le,{className:"h-5 w-5 text-red-500"});default:return e.jsx(v,{className:"h-5 w-5"})}},N=t=>{try{return de(new Date(t),"PPP")}catch{return t}},C=P();return e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s("store.myOrders")}),e.jsx("p",{className:"text-muted-foreground",children:s("store.trackYourOrders")})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(Y,{placeholder:s("store.searchOrders"),className:"pl-10 w-full md:w-[250px]",value:p,onChange:t=>E(t.target.value)})]}),e.jsx(x,{onClick:()=>m("/store"),children:s("store.continueShopping")})]})]}),e.jsxs(J,{defaultValue:"all",value:u,onValueChange:I,children:[e.jsxs(W,{className:"mb-6",children:[e.jsx(h,{value:"all",children:s("store.allOrders")}),e.jsx(h,{value:"pending",children:s("store.orderStatus.pending")}),e.jsx(h,{value:"processing",children:s("store.orderStatus.processing")}),e.jsx(h,{value:"shipped",children:s("store.orderStatus.shipped")}),e.jsx(h,{value:"delivered",children:s("store.orderStatus.delivered")}),e.jsx(h,{value:"cancelled",children:s("store.orderStatus.cancelled")})]}),e.jsx(X,{value:u,children:H?e.jsx("div",{className:"flex justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"h-10 w-10 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{children:s("store.loadingOrders")})]})}):C.length===0?e.jsx(S,{children:e.jsxs(T,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(v,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx(O,{className:"mb-2",children:s("store.noOrdersFound")}),e.jsx("p",{className:"text-center text-muted-foreground mb-6",children:s(p||u!=="all"?"store.tryDifferentFilters":"store.noOrdersYet")}),e.jsx(x,{onClick:()=>m("/store"),children:s("store.startShopping")})]})}):e.jsxs(S,{children:[e.jsx(G,{children:e.jsx(O,{children:s("store.orderHistory")})}),e.jsx(T,{children:e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(f,{children:[e.jsx(i,{children:s("store.orderNumber")}),e.jsx(i,{children:s("store.date")}),e.jsx(i,{children:s("store.status")}),e.jsx(i,{children:s("store.total")}),e.jsx(i,{className:"text-right",children:s("store.actions")})]})}),e.jsx(L,{children:C.map(t=>{var l,n;return e.jsxs(f,{children:[e.jsxs(d,{className:"font-medium",children:["#",t.id.slice(0,8)]}),e.jsx(d,{children:N(t.created_at)}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[_(t.status),w(t.status)]})}),e.jsxs(d,{children:["$",t.total_amount?t.total_amount.toFixed(2):"0.00"]}),e.jsx(d,{className:"text-right",children:e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>B(t),children:[s("store.viewDetails"),e.jsx(K,{className:"ml-1 h-4 w-4"})]})}),e.jsxs(se,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(re,{children:e.jsxs(te,{children:[s("store.orderDetails")," #",t.id.slice(0,8)]})}),r&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[_(r.status),e.jsx("span",{className:"font-medium",children:s(`store.orderStatus.${r.status}`)})]}),w(r.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:s("store.orderInformation")}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("store.orderNumber"),": "]}),r.id]}),e.jsxs("p",{children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("store.orderDate"),": "]}),N(r.created_at)]}),e.jsxs("p",{children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("store.paymentMethod"),": "]}),((l=r.payment_info)==null?void 0:l.method)==="cash_on_delivery"?s("store.cashOnDelivery"):(n=r.payment_info)==null?void 0:n.method]}),r.tracking_number&&e.jsxs("p",{children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("store.trackingNumber"),": "]}),r.tracking_number,e.jsx(x,{variant:"link",className:"p-0 h-auto text-primary ml-2",onClick:()=>window.open(`https://track.aftership.com/trackings?tracking_numbers=${r.tracking_number}`,"_blank"),children:e.jsx(ne,{className:"h-3 w-3 inline ml-1"})})]}),r.estimated_delivery&&e.jsxs("p",{children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("store.estimatedDelivery"),": "]}),N(r.estimated_delivery)]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:s("store.shippingAddress")}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("p",{children:r.shipping_address.name}),e.jsx("p",{children:r.shipping_address.street}),r.shipping_address.street2&&e.jsx("p",{children:r.shipping_address.street2}),e.jsxs("p",{children:[r.shipping_address.city,", ",r.shipping_address.state," ",r.shipping_address.zip]}),e.jsx("p",{children:r.shipping_address.country}),e.jsx("p",{children:r.shipping_address.phone})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-3",children:s("store.orderItems")}),e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(f,{children:[e.jsx(i,{children:s("store.product")}),e.jsx(i,{children:s("store.price")}),e.jsx(i,{children:s("store.quantity")}),e.jsx(i,{className:"text-right",children:s("store.total")})]})}),e.jsx(L,{children:r.items.map((a,j)=>e.jsxs(f,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.image_url&&e.jsx("div",{className:"h-12 w-12 rounded-md overflow-hidden",children:e.jsx("img",{src:a.image_url,alt:a.product_name,className:"h-full w-full object-cover"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.product_name}),a.selected_attributes&&Object.keys(a.selected_attributes).length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:Object.entries(a.selected_attributes).map(([k,A])=>e.jsxs("span",{className:"mr-2",children:[k,": ",A]},k))})]})]})}),e.jsxs(d,{children:["$",a.price?a.price.toFixed(2):"0.00"]}),e.jsx(d,{children:a.quantity}),e.jsxs(d,{className:"text-right",children:["$",a.price&&a.quantity?(a.price*a.quantity).toFixed(2):"0.00"]})]},j))})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"w-full md:w-1/2 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("store.subtotal")}),e.jsxs("span",{children:["$",r.subtotal?r.subtotal.toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("store.shipping")}),e.jsxs("span",{children:["$",r.shipping_fee?r.shipping_fee.toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("store.tax")}),e.jsxs("span",{children:["$",r.tax?r.tax.toFixed(2):"0.00"]})]}),r.discount&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s("store.discount")}),e.jsxs("span",{children:["-$",r.discount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-medium text-lg border-t pt-2 mt-2",children:[e.jsx("span",{children:s("store.total")}),e.jsxs("span",{children:["$",r.total_amount?r.total_amount.toFixed(2):"0.00"]})]})]})}),r.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:s("store.orderNotes")}),e.jsx("p",{className:"text-sm text-muted-foreground bg-muted p-3 rounded-md",children:r.notes})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[r.status==="pending"&&e.jsx(x,{variant:"destructive",children:s("store.cancelOrder")}),e.jsx(x,{children:s("store.contactSupport")})]})]})]})]})})]},t.id)})})]})})]})})]})]})};export{_e as default};
