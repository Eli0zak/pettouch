import{j as t}from"./ui-DskC_GZ4.js";import{r as c}from"./vendor-BlHcAAdO.js";import{k as v,K as w,N as C,T as L,B as i,O as P,P as S}from"./index-fU-TRYU7.js";import{C as h,b as M,c as T,d as F,a as E,e as U}from"./card-BKNPTKQ9.js";import{M as D}from"./map-pin-CaB-Fh_N.js";import{C as p}from"./calendar-BJg_nOUc.js";import{P as $,M as k}from"./phone-zyjSBqy0.js";import{f as A}from"./format-cwXK75ha.js";import"./supabase-C9Ps4N4y.js";import"./charts-DDg0wrp5.js";const W=()=>{const{t:a}=v(),{toast:f}=w();C();const[j,b]=c.useState([]),[y,o]=c.useState(!0),[r,g]=c.useState(""),[d,B]=c.useState("all"),[m,R]=c.useState("all");c.useEffect(()=>{N()},[]);const N=async()=>{o(!0);try{const{data:e,error:s}=await L.from("lost_found_posts").select("*").order("created_at",{ascending:!1});if(s)throw s;const l=e==null?void 0:e.map(n=>({...n,status:n.status}));b(l||[])}catch(e){console.error("Error fetching lost and found posts:",e),f({title:"Error",description:"Failed to load community reports",variant:"destructive"})}finally{o(!1)}},u=e=>{if(!e)return"Unknown date";try{return A(new Date(e),"PPP")}catch{return"Unknown date"}},_=e=>{switch(e){case"open":return"bg-amber-100 text-amber-800 border-amber-200";case"resolved":return"bg-green-100 text-green-800 border-green-200";case"closed":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}},x=j.filter(e=>{const s=e.title.toLowerCase().includes(r.toLowerCase())||e.description.toLowerCase().includes(r.toLowerCase())||e.pet_name&&e.pet_name.toLowerCase().includes(r.toLowerCase())||e.pet_breed&&e.pet_breed.toLowerCase().includes(r.toLowerCase())||e.last_seen_location&&e.last_seen_location.toLowerCase().includes(r.toLowerCase()),l=d==="all"||e.pet_type===d,n=m==="all"||e.status===m;return s&&l&&n});return t.jsxs("div",{className:"container mx-auto py-12 px-6",children:[t.jsxs("div",{className:"text-center mb-16",children:[t.jsx("h1",{className:"text-4xl font-bold mb-4",children:a("community.title")}),t.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto mb-8",children:a("community.description")}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-8",children:[t.jsx(i,{className:"bg-pet-primary hover:bg-pet-secondary text-white",children:a("community.reportLost")}),t.jsx(i,{variant:"outline",className:"border-pet-primary text-pet-primary hover:bg-pet-accent1/20",children:a("community.reportFound")})]}),t.jsx("div",{className:"max-w-xl mx-auto",children:t.jsxs("div",{className:"relative",children:[t.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),t.jsx(S,{type:"text",placeholder:a("community.searchPlaceholder"),value:r,onChange:e=>g(e.target.value),className:"pl-10"})]})})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y?t.jsx("div",{className:"flex justify-center items-center h-40",dir:"rtl",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-pet-primary"})}):x.length>0?x.map(e=>{var s,l;return t.jsxs(h,{className:"hover:shadow-lg transition-shadow",children:[t.jsxs(M,{children:[t.jsx("div",{className:"aspect-video rounded-md bg-muted mb-4",children:t.jsx("img",{src:e.image_url||`https://source.unsplash.com/featured/400x300?pet&${e.id}`,alt:e.title,className:"w-full h-full object-cover rounded-md"})}),t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsx(T,{className:"line-clamp-2",children:e.title}),t.jsx("div",{className:`px-2 py-1 text-xs rounded-full border ${_(e.status)}`,children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]}),t.jsx(F,{children:e.pet_type&&e.pet_breed?`${e.pet_type.charAt(0).toUpperCase()+e.pet_type.slice(1)} - ${e.pet_breed}`:((s=e.pet_type)==null?void 0:s.charAt(0).toUpperCase())+((l=e.pet_type)==null?void 0:l.slice(1))})]}),t.jsxs(E,{children:[t.jsx("p",{className:"text-sm line-clamp-3 mb-4",children:e.description}),t.jsxs("div",{className:"flex flex-col space-y-2 text-sm text-muted-foreground",children:[e.last_seen_location&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(D,{className:"h-3 w-3 mr-2"}),t.jsx("span",{children:e.last_seen_location})]}),e.last_seen_date&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(p,{className:"h-3 w-3 mr-2"}),t.jsx("span",{children:u(e.last_seen_date)})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(p,{className:"h-3 w-3 mr-2"}),t.jsxs("span",{children:["Posted: ",u(e.created_at)]})]}),(e.contact_phone||e.contact_email)&&t.jsxs("div",{className:"border-t pt-2 mt-2",children:[t.jsx("p",{className:"font-medium mb-1",children:"Contact Information:"}),e.contact_phone&&t.jsxs("div",{className:"flex items-center",children:[t.jsx($,{className:"h-3 w-3 mr-2"}),t.jsx("span",{children:e.contact_phone})]}),e.contact_email&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(k,{className:"h-3 w-3 mr-2"}),t.jsx("span",{children:e.contact_email})]})]})]})]}),t.jsx(U,{children:t.jsx(i,{variant:"outline",className:"w-full",children:a("community.viewDetails")})})]},e.id)}):t.jsx(h,{className:"p-8 text-center",children:t.jsx("p",{children:a("community.noReportsFound")})})})]})};export{W as default};
